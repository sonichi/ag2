<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A programming framework for agentic AI"><meta name=author content="Chi Wang & Qingyun Wu"><link href=https://docs.ag2.ai/latest/docs/user-guide/advanced-concepts/orchestration/group-chat/handoffs/ rel=canonical><link href=../context-variables/ rel=prev><link href=../patterns/ rel=next><link rel=icon href=../../../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.12"><title>Handoffs - AG2</title><link rel=stylesheet href=../../../../../../assets/stylesheets/main.2afb09e1.min.css><link rel=stylesheet href=../../../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../../css/timeago.css><link rel=stylesheet href=../../../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../../../stylesheets/extra.ff0633.min.css><script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2GN2KN2CE4"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2GN2KN2CE4",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2GN2KN2CE4",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta http-equiv=Cache-Control content="no-cache, no-store, must-revalidate"><meta property=og:type content=website><meta property=og:title content="AG2 - Handoffs"><meta property=og:description content="A programming framework for agentic AI"><meta content=https://docs.ag2.ai/latest/docs/user-guide/advanced-concepts/orchestration/group-chat/handoffs/ property=og:url><meta property=og:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="AG2 - Handoffs"><meta name=twitter:description content="A programming framework for agentic AI"><meta name=twitter:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon-dark.svg type=image/x-icon media="(prefers-color-scheme: light)"><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon media="(prefers-color-scheme: dark)"><link href=../../../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../../../../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#introduction-to-handoffs class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../../../../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../../../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../../.. title=AG2 class="md-header__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../../../assets/img/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AG2 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Handoffs </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../../quick-start/ class=md-tabs__link> Quick Start </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../../basic-concepts/installing-ag2/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../../../../api-reference/autogen/Agent/ class=md-tabs__link> API References </a> </li> <li class=md-tabs__item> <a href=../../../../../contributor-guide/contributing/ class=md-tabs__link> Contributor Guide </a> </li> <li class=md-tabs__item> <a href=../../../../../ecosystem/agentops/ class=md-tabs__link> Ecosystem </a> </li> <li class=md-tabs__item> <a href=../../../../../use-cases/use-cases/customer-service/ class=md-tabs__link> Use Cases </a> </li> <li class=md-tabs__item> <a href=../../../../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-tabs__link> Community Insights </a> </li> <li class=md-tabs__item> <a href=../../../../../blog/ class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../../.. title=AG2 class="md-nav__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../../../assets/img/logo.svg alt=logo> </a> AG2 </label> <div class=md-nav__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../basic-concepts/installing-ag2/ class=md-nav__link> <span class=md-ellipsis> Installing AG2 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../basic-concepts/overview/ class=md-nav__link> <span class=md-ellipsis> Basic Concepts </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> Advanced Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Advanced Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../llm-configuration-deep-dive/ class=md-nav__link> <span class=md-ellipsis> LLM Configuration Deep Dive </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_2 checked> <label class=md-nav__link for=__nav_2_3_2 id=__nav_2_3_2_label tabindex=0> <span class=md-ellipsis> Agent Orchestration Deep Dive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_3_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3_2> <span class="md-nav__icon md-icon"></span> Agent Orchestration Deep Dive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../orchestrations/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../two-agent-chat/ class=md-nav__link> <span class=md-ellipsis> Two Agent Chat </span> </a> </li> <li class=md-nav__item> <a href=../../sequential-chat/ class=md-nav__link> <span class=md-ellipsis> Sequential Chat </span> </a> </li> <li class=md-nav__item> <a href=../../nested-chat/ class=md-nav__link> <span class=md-ellipsis> Nested Chat </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_2_5 checked> <label class=md-nav__link for=__nav_2_3_2_5 id=__nav_2_3_2_5_label tabindex=0> <span class=md-ellipsis> Group Chats </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_2_5_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3_2_5> <span class="md-nav__icon md-icon"></span> Group Chats </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../introduction/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../agent-tools-functions/ class=md-nav__link> <span class=md-ellipsis> Tools and Functions </span> </a> </li> <li class=md-nav__item> <a href=../context-variables/ class=md-nav__link> <span class=md-ellipsis> Context Variables </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Handoffs </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Handoffs </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction-to-handoffs class=md-nav__link> <span class=md-ellipsis> Introduction to Handoffs </span> </a> <nav class=md-nav aria-label="Introduction to Handoffs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#why-handoffs-matter class=md-nav__link> <span class=md-ellipsis> Why Handoffs Matter </span> </a> </li> <li class=md-nav__item> <a href=#the-hospital-triage-analogy class=md-nav__link> <span class=md-ellipsis> The Hospital Triage Analogy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#core-handoff-concepts class=md-nav__link> <span class=md-ellipsis> Core Handoff Concepts </span> </a> <nav class=md-nav aria-label="Core Handoff Concepts"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#transition-targets class=md-nav__link> <span class=md-ellipsis> Transition Targets </span> </a> </li> <li class=md-nav__item> <a href=#replyresults-and-transitions class=md-nav__link> <span class=md-ellipsis> ReplyResults and Transitions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#types-of-handoffs class=md-nav__link> <span class=md-ellipsis> Types of Handoffs </span> </a> <nav class=md-nav aria-label="Types of Handoffs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#llm-based-conditions class=md-nav__link> <span class=md-ellipsis> LLM-Based Conditions </span> </a> </li> <li class=md-nav__item> <a href=#context-based-conditions class=md-nav__link> <span class=md-ellipsis> Context-Based Conditions </span> </a> </li> <li class=md-nav__item> <a href=#after-work-behavior class=md-nav__link> <span class=md-ellipsis> After-Work Behavior </span> </a> </li> <li class=md-nav__item> <a href=#explicit-handoffs-from-tools class=md-nav__link> <span class=md-ellipsis> Explicit Handoffs from Tools </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuring-handoffs-for-agents class=md-nav__link> <span class=md-ellipsis> Configuring Handoffs for Agents </span> </a> <nav class=md-nav aria-label="Configuring Handoffs for Agents"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enhancing-our-support-system-with-handoffs class=md-nav__link> <span class=md-ellipsis> Enhancing our Support System with Handoffs </span> </a> </li> <li class=md-nav__item> <a href=#setting-up-the-initial-structure class=md-nav__link> <span class=md-ellipsis> Setting Up the Initial Structure </span> </a> </li> <li class=md-nav__item> <a href=#creating-tool-functions class=md-nav__link> <span class=md-ellipsis> Creating Tool Functions </span> </a> </li> <li class=md-nav__item> <a href=#configuring-llm-based-handoffs class=md-nav__link> <span class=md-ellipsis> Configuring LLM-Based Handoffs </span> </a> </li> <li class=md-nav__item> <a href=#configuring-context-based-handoffs class=md-nav__link> <span class=md-ellipsis> Configuring Context-Based Handoffs </span> </a> </li> <li class=md-nav__item> <a href=#setting-default-after-work-behavior class=md-nav__link> <span class=md-ellipsis> Setting Default After-Work Behavior </span> </a> </li> <li class=md-nav__item> <a href=#putting-it-all-together class=md-nav__link> <span class=md-ellipsis> Putting It All Together </span> </a> </li> <li class=md-nav__item> <a href=#complete-example class=md-nav__link> <span class=md-ellipsis> Complete Example </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#example-output class=md-nav__link> <span class=md-ellipsis> Example Output </span> </a> </li> <li class=md-nav__item> <a href=#next-steps-putting-everything-together-with-patterns class=md-nav__link> <span class=md-ellipsis> Next Steps: Putting Everything Together with Patterns </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../patterns/ class=md-nav__link> <span class=md-ellipsis> Orchestration Patterns </span> </a> </li> <li class=md-nav__item> <a href=../guardrails/ class=md-nav__link> <span class=md-ellipsis> Guardrails </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../swarm/deprecation/ class=md-nav__link> <span class=md-ellipsis> Swarm </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../ending-a-chat/ class=md-nav__link> <span class=md-ellipsis> Ending A Chat </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../pattern-cookbook/overview/ class=md-nav__link> <span class=md-ellipsis> Pattern Cookbook </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../tools/ class=md-nav__link> <span class=md-ellipsis> Tools </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../realtime-agent/ class=md-nav__link> <span class=md-ellipsis> RealtimeAgent </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../../rag/ class=md-nav__link> <span class=md-ellipsis> RAG </span> </a> </li> <li class=md-nav__item> <a href=../../../code-execution/ class=md-nav__link> <span class=md-ellipsis> Code Execution </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../models/amazon-bedrock/ class=md-nav__link> <span class=md-ellipsis> Model Providers </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../reference-agents/ class=md-nav__link> <span class=md-ellipsis> Reference Agents </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../reference-tools/ class=md-nav__link> <span class=md-ellipsis> Reference Tools </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../../../../faq/FAQ/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../api-reference/autogen/Agent/ class=md-nav__link> <span class=md-ellipsis> API References </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../contributor-guide/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributor Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../ecosystem/agentops/ class=md-nav__link> <span class=md-ellipsis> Ecosystem </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../use-cases/use-cases/customer-service/ class=md-nav__link> <span class=md-ellipsis> Use Cases </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-nav__link> <span class=md-ellipsis> Community Insights </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../blog/ class=md-nav__link> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction-to-handoffs class=md-nav__link> <span class=md-ellipsis> Introduction to Handoffs </span> </a> <nav class=md-nav aria-label="Introduction to Handoffs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#why-handoffs-matter class=md-nav__link> <span class=md-ellipsis> Why Handoffs Matter </span> </a> </li> <li class=md-nav__item> <a href=#the-hospital-triage-analogy class=md-nav__link> <span class=md-ellipsis> The Hospital Triage Analogy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#core-handoff-concepts class=md-nav__link> <span class=md-ellipsis> Core Handoff Concepts </span> </a> <nav class=md-nav aria-label="Core Handoff Concepts"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#transition-targets class=md-nav__link> <span class=md-ellipsis> Transition Targets </span> </a> </li> <li class=md-nav__item> <a href=#replyresults-and-transitions class=md-nav__link> <span class=md-ellipsis> ReplyResults and Transitions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#types-of-handoffs class=md-nav__link> <span class=md-ellipsis> Types of Handoffs </span> </a> <nav class=md-nav aria-label="Types of Handoffs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#llm-based-conditions class=md-nav__link> <span class=md-ellipsis> LLM-Based Conditions </span> </a> </li> <li class=md-nav__item> <a href=#context-based-conditions class=md-nav__link> <span class=md-ellipsis> Context-Based Conditions </span> </a> </li> <li class=md-nav__item> <a href=#after-work-behavior class=md-nav__link> <span class=md-ellipsis> After-Work Behavior </span> </a> </li> <li class=md-nav__item> <a href=#explicit-handoffs-from-tools class=md-nav__link> <span class=md-ellipsis> Explicit Handoffs from Tools </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuring-handoffs-for-agents class=md-nav__link> <span class=md-ellipsis> Configuring Handoffs for Agents </span> </a> <nav class=md-nav aria-label="Configuring Handoffs for Agents"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enhancing-our-support-system-with-handoffs class=md-nav__link> <span class=md-ellipsis> Enhancing our Support System with Handoffs </span> </a> </li> <li class=md-nav__item> <a href=#setting-up-the-initial-structure class=md-nav__link> <span class=md-ellipsis> Setting Up the Initial Structure </span> </a> </li> <li class=md-nav__item> <a href=#creating-tool-functions class=md-nav__link> <span class=md-ellipsis> Creating Tool Functions </span> </a> </li> <li class=md-nav__item> <a href=#configuring-llm-based-handoffs class=md-nav__link> <span class=md-ellipsis> Configuring LLM-Based Handoffs </span> </a> </li> <li class=md-nav__item> <a href=#configuring-context-based-handoffs class=md-nav__link> <span class=md-ellipsis> Configuring Context-Based Handoffs </span> </a> </li> <li class=md-nav__item> <a href=#setting-default-after-work-behavior class=md-nav__link> <span class=md-ellipsis> Setting Default After-Work Behavior </span> </a> </li> <li class=md-nav__item> <a href=#putting-it-all-together class=md-nav__link> <span class=md-ellipsis> Putting It All Together </span> </a> </li> <li class=md-nav__item> <a href=#complete-example class=md-nav__link> <span class=md-ellipsis> Complete Example </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#example-output class=md-nav__link> <span class=md-ellipsis> Example Output </span> </a> </li> <li class=md-nav__item> <a href=#next-steps-putting-everything-together-with-patterns class=md-nav__link> <span class=md-ellipsis> Next Steps: Putting Everything Together with Patterns </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ag2ai/ag2/edit/main/website/docs/user-guide/advanced-concepts/orchestration/group-chat/handoffs.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m7 14.94 6.06-6.06 2.06 2.06L9.06 17H7zM12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m4.7-10.65-1 1-2.05-2.05 1-1c.21-.22.56-.22.77 0l1.28 1.28c.22.21.22.56 0 .77M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2"/></svg> </a> <h1>Handoffs</h1> <p>Handoffs are the essential mechanism that controls how agents interact and pass control to each other in a group chat. If tools represent what agents can do and context variables represent what they know, handoffs determine where they go next.</p> <h2 id=introduction-to-handoffs>Introduction to Handoffs<a class=headerlink href=#introduction-to-handoffs title="Permanent link">#</a></h2> <p>Handoffs define the paths a conversation can take through your multi-agent system. They allow you to create sophisticated workflows where the right agent handles each part of a conversation at the right time.</p> <h3 id=why-handoffs-matter>Why Handoffs Matter<a class=headerlink href=#why-handoffs-matter title="Permanent link">#</a></h3> <p>In any multi-agent system, you need to carefully control which agent speaks when.</p> <p>Handoffs provide this control by:</p> <ul> <li>Directing the conversation to the most appropriate agent for each situation</li> <li>Creating predictable workflows with clear transitions</li> <li>Enabling complex decision trees based on conversation state</li> <li>Allowing dynamic adaptation to user inputs</li> </ul> <h3 id=the-hospital-triage-analogy>The Hospital Triage Analogy<a class=headerlink href=#the-hospital-triage-analogy title="Permanent link">#</a></h3> <p>Extending our hospital emergency room analogy, when a patient enters the ER, they first see a triage nurse who assesses their condition. The triage nurse then makes a critical decision:</p> <ul> <li>For cardiac symptoms, transfer immediately to the cardiologist</li> <li>For respiratory issues, send to the pulmonologist</li> <li>For minor injuries, direct to the general practitioner</li> <li>For severe trauma, rush to the trauma surgeon</li> </ul> <p>Each medical professional follows specific "handoff protocols" that determine:</p> <ul> <li>When they need to transfer a patient</li> <li>Who they should transfer to</li> <li>What information must be included in the handoff</li> </ul> <p>These protocols ensure the patient receives the right care at the right time. In AG2, handoffs serve the same purpose for your conversational agents.</p> <h2 id=core-handoff-concepts>Core Handoff Concepts<a class=headerlink href=#core-handoff-concepts title="Permanent link">#</a></h2> <p>Each agent in AG2 has a <code>handoffs</code> attribute that manages transitions from that agent. The <strong>handoffs attribute is an instance of the <a href=../../../../../api-reference/autogen/agentchat/group/handoffs/Handoffs><code>Handoffs</code></a> class</strong>, which provides methods for defining when and where control should pass:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># Access an agent&#39;s handoffs</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=n>my_agent</span><span class=o>.</span><span class=n>handoffs</span>
</code></pre></div> <h3 id=transition-targets>Transition Targets<a class=headerlink href=#transition-targets title="Permanent link">#</a></h3> <p>When defining a handoff, you specify a transition target - the destination where control should go. AG2 provides several types of transition targets:</p> <ul> <li><a href=../../../../../api-reference/autogen/agentchat/group/targets/transition_target/AgentNameTarget><code>AgentNameTarget</code></a>: Transfer control to an agent by name</li> <li><a href=../../../../../api-reference/autogen/agentchat/group/targets/transition_target/AgentTarget><code>AgentTarget</code></a>: Transfer control to a specific agent instance</li> <li><a href=../../../../../api-reference/autogen/agentchat/group/targets/transition_target/AskUserTarget><code>AskUserTarget</code></a>: Ask the user to select the next speaker</li> <li><a href=../../../../../api-reference/autogen/agentchat/group/targets/transition_target/NestedChatTarget><code>NestedChatTarget</code></a>: Target that represents a nested chat configuration</li> <li><a href=../../../../../api-reference/autogen/agentchat/group/targets/group_manager_target/GroupManagerTarget><code>GroupManagerTarget</code></a>: Transfer control to the group manager who will select the next speaker</li> <li><a href=../../../../../api-reference/autogen/agentchat/group/GroupChatTarget><code>GroupChatTarget</code></a>: Transfer control to another group chat (essentially a nested group chat)</li> <li><a href=../../../../../api-reference/autogen/agentchat/group/targets/transition_target/RandomAgentTarget><code>RandomAgentTarget</code></a>: Randomly select from a list of agents</li> <li><a href=../../../../../api-reference/autogen/agentchat/group/targets/transition_target/RevertToUserTarget><code>RevertToUserTarget</code></a>: Return control to the user agent</li> <li><a href=../../../../../api-reference/autogen/agentchat/group/targets/transition_target/StayTarget><code>StayTarget</code></a>: Keep control with the current agent</li> <li><a href=../../../../../api-reference/autogen/agentchat/group/targets/transition_target/TerminateTarget><code>TerminateTarget</code></a>: End the conversation</li> </ul> <p>Here's how you might use transition targets:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat.group</span><span class=w> </span><span class=kn>import</span> <span class=n>AgentTarget</span><span class=p>,</span> <span class=n>RevertToUserTarget</span><span class=p>,</span> <span class=n>TerminateTarget</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=c1># Transition to a specific agent</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=n>target</span> <span class=o>=</span> <span class=n>AgentTarget</span><span class=p>(</span><span class=n>tech_agent</span><span class=p>)</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=c1># Return to the user</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=n>target</span> <span class=o>=</span> <span class=n>RevertToUserTarget</span><span class=p>()</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=c1># End the conversation</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=n>target</span> <span class=o>=</span> <span class=n>TerminateTarget</span><span class=p>()</span>
</code></pre></div> <h3 id=replyresults-and-transitions>ReplyResults and Transitions<a class=headerlink href=#replyresults-and-transitions title="Permanent link">#</a></h3> <p>Each tool function can return a <a href=../../../../../api-reference/autogen/agentchat/group/reply_result/ReplyResult><code>ReplyResult</code></a> that specifies a transition target:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>def</span><span class=w> </span><span class=nf>my_tool_function</span><span class=p>(</span><span class=n>param</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>context_variables</span><span class=p>:</span> <span class=n>ContextVariables</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ReplyResult</span><span class=p>:</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>    <span class=k>return</span> <span class=n>ReplyResult</span><span class=p>(</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>        <span class=n>message</span><span class=o>=</span><span class=s2>&quot;Tool result message&quot;</span><span class=p>,</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=hll>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>next_agent</span><span class=p>),</span>  <span class=c1># Where to go next</span>
</span><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>        <span class=n>context_variables</span><span class=o>=</span><span class=n>context_variables</span>  <span class=c1># Updated context</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>    <span class=p>)</span>
</code></pre></div> <p>This creates a powerful mechanism where tools can determine the conversation flow based on their results.</p> <h2 id=types-of-handoffs>Types of Handoffs<a class=headerlink href=#types-of-handoffs title="Permanent link">#</a></h2> <p>AG2 offers four main ways to define handoffs:</p> <ul> <li><strong>LLM-based conditions</strong>: Transitions based on the language model's analysis of messages</li> <li><strong>Context-based conditions</strong>: Transitions based on values in context variables</li> <li><strong>After-work behavior</strong>: Default transition when no LLM or context conditions are met and no tools are called</li> <li><strong>Explicit handoffs from tools</strong>: Direct transitions specified by tool return values</li> </ul> <p>Let's explore each type in our triage example.</p> <h3 id=llm-based-conditions>LLM-Based Conditions<a class=headerlink href=#llm-based-conditions title="Permanent link">#</a></h3> <p>LLM-based conditions use the language model to determine when a transition should occur. This is useful when the decision depends on understanding the meaning of messages:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat.group</span><span class=w> </span><span class=kn>import</span> <span class=n>OnCondition</span><span class=p>,</span> <span class=n>StringLLMCondition</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=c1># Set up LLM-based handoffs for the triage agent</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=n>triage_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>add_llm_conditions</span><span class=p>([</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=hll>    <span class=n>OnCondition</span><span class=p>(</span>
</span><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=hll>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>tech_agent</span><span class=p>),</span>
</span><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=hll>        <span class=n>condition</span><span class=o>=</span><span class=n>StringLLMCondition</span><span class=p>(</span><span class=n>prompt</span><span class=o>=</span><span class=s2>&quot;When the user query is related to technical issues.&quot;</span><span class=p>),</span>
</span><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=hll>    <span class=p>),</span>
</span><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=hll>    <span class=n>OnCondition</span><span class=p>(</span>
</span><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=hll>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>general_agent</span><span class=p>),</span>
</span><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=hll>        <span class=n>condition</span><span class=o>=</span><span class=n>StringLLMCondition</span><span class=p>(</span><span class=n>prompt</span><span class=o>=</span><span class=s2>&quot;When the user query is related to general questions.&quot;</span><span class=p>),</span>
</span><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>    <span class=p>)</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=p>])</span>
</code></pre></div> <p>In this example, the <code>triage_agent</code> uses the LLM to evaluate each condition prompt against the messages in the conversation. If it determines that the user query is about a technical issue, control passes to the tech agent.</p> <h3 id=context-based-conditions>Context-Based Conditions<a class=headerlink href=#context-based-conditions title="Permanent link">#</a></h3> <p>Context-based conditions transition based on the values of context variables. This is ideal for decisions that depend on the system's state rather than message content:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat.group</span><span class=w> </span><span class=kn>import</span> <span class=n>OnContextCondition</span><span class=p>,</span> <span class=n>ExpressionContextCondition</span><span class=p>,</span> <span class=n>ContextExpression</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=c1># Set up context-based handoffs for the tech agent</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=n>tech_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>add_context_condition</span><span class=p>(</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=hll>    <span class=n>OnContextCondition</span><span class=p>(</span>
</span><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=hll>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>escalation_agent</span><span class=p>),</span>
</span><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=hll>        <span class=n>condition</span><span class=o>=</span><span class=n>ExpressionContextCondition</span><span class=p>(</span>
</span><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=hll>            <span class=n>expression</span><span class=o>=</span><span class=n>ContextExpression</span><span class=p>(</span><span class=s2>&quot;$</span><span class=si>{issue_severity}</span><span class=s2> &gt;= 8&quot;</span><span class=p>)</span>
</span><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=hll>        <span class=p>)</span>
</span><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=hll>    <span class=p>)</span>
</span><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=hll><span class=p>)</span>
</span></code></pre></div> <p>This example transitions to an escalation agent when the <strong><code>issue_severity</code> context variable is 8 or higher</strong>.</p> <h3 id=after-work-behavior>After-Work Behavior<a class=headerlink href=#after-work-behavior title="Permanent link">#</a></h3> <p>After-work behavior defines the default transition that occurs after an agent completes its work and no specific condition is met:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># Set the default after-work transition</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=n>tech_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>set_after_work</span><span class=p>(</span><span class=n>RevertToUserTarget</span><span class=p>())</span>
</code></pre></div> <p>In this example, control returns to the user after the tech agent finishes speaking, unless another condition routes it elsewhere.</p> <h3 id=explicit-handoffs-from-tools>Explicit Handoffs from Tools<a class=headerlink href=#explicit-handoffs-from-tools title="Permanent link">#</a></h3> <p>Tools can specify transitions directly in their return values:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=k>def</span><span class=w> </span><span class=nf>classify_query</span><span class=p>(</span><span class=n>query</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>context_variables</span><span class=p>:</span> <span class=n>ContextVariables</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ReplyResult</span><span class=p>:</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>    <span class=k>if</span> <span class=n>is_technical</span><span class=p>:</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>        <span class=k>return</span> <span class=n>ReplyResult</span><span class=p>(</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>            <span class=n>message</span><span class=o>=</span><span class=s2>&quot;This is a technical issue.&quot;</span><span class=p>,</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=hll>            <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>tech_agent</span><span class=p>),</span>
</span><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>            <span class=n>context_variables</span><span class=o>=</span><span class=n>context_variables</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>        <span class=p>)</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>        <span class=k>return</span> <span class=n>ReplyResult</span><span class=p>(</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>            <span class=n>message</span><span class=o>=</span><span class=s2>&quot;This is a general question.&quot;</span><span class=p>,</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=hll>            <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>general_agent</span><span class=p>),</span>
</span><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>            <span class=n>context_variables</span><span class=o>=</span><span class=n>context_variables</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>        <span class=p>)</span>
</code></pre></div> <p>This gives you the most direct control over transitions based on tool execution results.</p> <h2 id=configuring-handoffs-for-agents>Configuring Handoffs for Agents<a class=headerlink href=#configuring-handoffs-for-agents title="Permanent link">#</a></h2> <p>Let's build a tech support system to demonstrate different types of handoffs and how they work together to create a seamless user experience.</p> <h3 id=enhancing-our-support-system-with-handoffs>Enhancing our Support System with Handoffs<a class=headerlink href=#enhancing-our-support-system-with-handoffs title="Permanent link">#</a></h3> <p>We will enhance our support system with multiple specialized agents that handle different aspects of customer service:</p> <ul> <li>A triage agent that analyzes initial queries</li> <li>A general support agent for non-technical questions</li> <li>Specialists for different device types (computers and smartphones)</li> <li>An advanced troubleshooting agent for persistent issues</li> </ul> <p>This example demonstrates how a real-world support system might use handoffs to route customers efficiently.</p> <h3 id=setting-up-the-initial-structure>Setting Up the Initial Structure<a class=headerlink href=#setting-up-the-initial-structure title="Permanent link">#</a></h3> <p>First, let's create our context variables and agents: <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Annotated</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat</span><span class=w> </span><span class=kn>import</span> <span class=n>initiate_group_chat</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat.group.patterns</span><span class=w> </span><span class=kn>import</span> <span class=n>AutoPattern</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat.group</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>    <span class=n>ContextVariables</span><span class=p>,</span> <span class=n>ReplyResult</span><span class=p>,</span> <span class=n>AgentTarget</span><span class=p>,</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>    <span class=n>OnCondition</span><span class=p>,</span> <span class=n>StringLLMCondition</span><span class=p>,</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>    <span class=n>OnContextCondition</span><span class=p>,</span> <span class=n>ExpressionContextCondition</span><span class=p>,</span> <span class=n>ContextExpression</span><span class=p>,</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>    <span class=n>RevertToUserTarget</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=p>)</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=c1># Initialize context variables for our support system</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=n>support_context</span> <span class=o>=</span> <span class=n>ContextVariables</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=p>{</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>    <span class=s2>&quot;query_count&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>    <span class=s2>&quot;repeat_issue&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>    <span class=s2>&quot;previous_solutions&quot;</span><span class=p>:</span> <span class=p>[],</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a>    <span class=s2>&quot;issue_type&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a>    <span class=s2>&quot;issue_subtype&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=p>})</span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a>
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=c1># Configure the LLM</span>
<a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>(</span><span class=n>api_type</span><span class=o>=</span><span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=s2>&quot;gpt-4o-mini&quot;</span><span class=p>)</span>
<a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a>
<a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=c1># Create all our support agents</span>
<a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=k>with</span> <span class=n>llm_config</span><span class=p>:</span>
<a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a>    <span class=c1># Main triage agent - the starting point for all user queries</span>
<a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a>    <span class=n>triage_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;triage_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are a support triage agent. Your role is to:</span>
<a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a><span class=s2>        1. Determine if a query is technical or general</span>
<a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a><span class=s2>        2. Use the classify_query function to route appropriately</span>
<a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a>
<a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a><span class=s2>        Do not attempt to solve issues yourself - your job is proper routing.&quot;&quot;&quot;</span>
<a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a>    <span class=p>)</span>
<a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a>
<a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a>    <span class=c1># General support for non-technical questions</span>
<a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a>    <span class=n>general_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;general_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are a general support agent who handles non-technical questions.</span>
<a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a><span class=s2>        If the user is a premium customer (check account_tier context variable),</span>
<a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a><span class=s2>        you should transfer them directly to the premium support agent.</span>
<a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a><span class=s2>        Otherwise, provide helpful responses to general inquiries.&quot;&quot;&quot;</span>
<a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a>    <span class=p>)</span>
<a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a>
<a id=__codelineno-7-45 name=__codelineno-7-45 href=#__codelineno-7-45></a>    <span class=c1># Tech agent for initial technical assessment</span>
<a id=__codelineno-7-46 name=__codelineno-7-46 href=#__codelineno-7-46></a>    <span class=n>tech_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-7-47 name=__codelineno-7-47 href=#__codelineno-7-47></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;tech_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-7-48 name=__codelineno-7-48 href=#__codelineno-7-48></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are a technical support agent who handles the initial assessment</span>
<a id=__codelineno-7-49 name=__codelineno-7-49 href=#__codelineno-7-49></a><span class=s2>        of all technical issues.</span>
<a id=__codelineno-7-50 name=__codelineno-7-50 href=#__codelineno-7-50></a>
<a id=__codelineno-7-51 name=__codelineno-7-51 href=#__codelineno-7-51></a><span class=s2>        If the user is a premium customer (check account_tier context variable),</span>
<a id=__codelineno-7-52 name=__codelineno-7-52 href=#__codelineno-7-52></a><span class=s2>        you should transfer them directly to the premium support agent.</span>
<a id=__codelineno-7-53 name=__codelineno-7-53 href=#__codelineno-7-53></a>
<a id=__codelineno-7-54 name=__codelineno-7-54 href=#__codelineno-7-54></a><span class=s2>        Otherwise, determine if the issue is related to:</span>
<a id=__codelineno-7-55 name=__codelineno-7-55 href=#__codelineno-7-55></a><span class=s2>        - Computer issues (laptops, desktops, PCs, Macs)</span>
<a id=__codelineno-7-56 name=__codelineno-7-56 href=#__codelineno-7-56></a><span class=s2>        - Smartphone issues (iPhones, Android phones, tablets)</span>
<a id=__codelineno-7-57 name=__codelineno-7-57 href=#__codelineno-7-57></a>
<a id=__codelineno-7-58 name=__codelineno-7-58 href=#__codelineno-7-58></a><span class=s2>        And route to the appropriate specialist.&quot;&quot;&quot;</span>
<a id=__codelineno-7-59 name=__codelineno-7-59 href=#__codelineno-7-59></a>    <span class=p>)</span>
<a id=__codelineno-7-60 name=__codelineno-7-60 href=#__codelineno-7-60></a>
<a id=__codelineno-7-61 name=__codelineno-7-61 href=#__codelineno-7-61></a>    <span class=c1># Device-specific agents</span>
<a id=__codelineno-7-62 name=__codelineno-7-62 href=#__codelineno-7-62></a>    <span class=n>computer_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-7-63 name=__codelineno-7-63 href=#__codelineno-7-63></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;computer_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-7-64 name=__codelineno-7-64 href=#__codelineno-7-64></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are a computer specialist who handles issues with laptops, desktops,</span>
<a id=__codelineno-7-65 name=__codelineno-7-65 href=#__codelineno-7-65></a><span class=s2>        PCs, and Macs. You provide troubleshooting for hardware and software issues specific to</span>
<a id=__codelineno-7-66 name=__codelineno-7-66 href=#__codelineno-7-66></a><span class=s2>        computers. You&#39;re knowledgeable about Windows, macOS, Linux, and common computer peripherals.</span>
<a id=__codelineno-7-67 name=__codelineno-7-67 href=#__codelineno-7-67></a>
<a id=__codelineno-7-68 name=__codelineno-7-68 href=#__codelineno-7-68></a><span class=s2>        For first-time issues, provide a solution directly.</span>
<a id=__codelineno-7-69 name=__codelineno-7-69 href=#__codelineno-7-69></a>
<a id=__codelineno-7-70 name=__codelineno-7-70 href=#__codelineno-7-70></a><span class=s2>        If a user returns and says they tried your solution but are still having the issue,</span>
<a id=__codelineno-7-71 name=__codelineno-7-71 href=#__codelineno-7-71></a><span class=s2>        use the check_repeat_issue function to escalate to advanced troubleshooting. Do not provide a solution</span>
<a id=__codelineno-7-72 name=__codelineno-7-72 href=#__codelineno-7-72></a><span class=s2>        yourself for returning users, simply route it to advanced troubleshooting.&quot;&quot;&quot;</span>
<a id=__codelineno-7-73 name=__codelineno-7-73 href=#__codelineno-7-73></a>    <span class=p>)</span>
<a id=__codelineno-7-74 name=__codelineno-7-74 href=#__codelineno-7-74></a>
<a id=__codelineno-7-75 name=__codelineno-7-75 href=#__codelineno-7-75></a>    <span class=n>smartphone_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-7-76 name=__codelineno-7-76 href=#__codelineno-7-76></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;smartphone_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-7-77 name=__codelineno-7-77 href=#__codelineno-7-77></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are a smartphone specialist who handles issues with mobile devices</span>
<a id=__codelineno-7-78 name=__codelineno-7-78 href=#__codelineno-7-78></a><span class=s2>        including iPhones, Android phones, and tablets. You&#39;re knowledgeable about iOS, Android,</span>
<a id=__codelineno-7-79 name=__codelineno-7-79 href=#__codelineno-7-79></a><span class=s2>        mobile apps, battery issues, screen problems, and connectivity troubleshooting.</span>
<a id=__codelineno-7-80 name=__codelineno-7-80 href=#__codelineno-7-80></a>
<a id=__codelineno-7-81 name=__codelineno-7-81 href=#__codelineno-7-81></a><span class=s2>        For first-time issues, provide a solution directly.</span>
<a id=__codelineno-7-82 name=__codelineno-7-82 href=#__codelineno-7-82></a>
<a id=__codelineno-7-83 name=__codelineno-7-83 href=#__codelineno-7-83></a><span class=s2>        If a user returns and says they tried your solution but are still having the issue,</span>
<a id=__codelineno-7-84 name=__codelineno-7-84 href=#__codelineno-7-84></a><span class=s2>        use the check_repeat_issue function to escalate to advanced troubleshooting. Do not provide a solution</span>
<a id=__codelineno-7-85 name=__codelineno-7-85 href=#__codelineno-7-85></a><span class=s2>        yourself for returning users, simply route it to advanced troubleshooting&quot;&quot;&quot;</span>
<a id=__codelineno-7-86 name=__codelineno-7-86 href=#__codelineno-7-86></a>    <span class=p>)</span>
<a id=__codelineno-7-87 name=__codelineno-7-87 href=#__codelineno-7-87></a>
<a id=__codelineno-7-88 name=__codelineno-7-88 href=#__codelineno-7-88></a>    <span class=c1># Advanced troubleshooting for complex issues</span>
<a id=__codelineno-7-89 name=__codelineno-7-89 href=#__codelineno-7-89></a>    <span class=n>advanced_troubleshooting_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-7-90 name=__codelineno-7-90 href=#__codelineno-7-90></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;advanced_troubleshooting_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-7-91 name=__codelineno-7-91 href=#__codelineno-7-91></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are an advanced troubleshooting specialist who handles complex,</span>
<a id=__codelineno-7-92 name=__codelineno-7-92 href=#__codelineno-7-92></a><span class=s2>        persistent issues that weren&#39;t resolved by initial solutions. You provide deeper</span>
<a id=__codelineno-7-93 name=__codelineno-7-93 href=#__codelineno-7-93></a><span class=s2>        diagnostic approaches and more comprehensive solutions for difficult technical problems.&quot;&quot;&quot;</span>
<a id=__codelineno-7-94 name=__codelineno-7-94 href=#__codelineno-7-94></a>    <span class=p>)</span>
</code></pre></div></p> <h3 id=creating-tool-functions>Creating Tool Functions<a class=headerlink href=#creating-tool-functions title="Permanent link">#</a></h3> <p>Now let's define the tool functions that enable our agents to make routing decisions and update the conversation state:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># Define tool functions</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=k>def</span><span class=w> </span><span class=nf>classify_query</span><span class=p>(</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>    <span class=n>query</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=s2>&quot;The user query to classify&quot;</span><span class=p>],</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>    <span class=n>context_variables</span><span class=p>:</span> <span class=n>ContextVariables</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ReplyResult</span><span class=p>:</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Classify a user query and route to the appropriate agent.&quot;&quot;&quot;</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>    <span class=c1># Update query count</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>    <span class=n>context_variables</span><span class=p>[</span><span class=s2>&quot;query_count&quot;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>    <span class=c1># Simple classification logic</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>    <span class=n>technical_keywords</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;error&quot;</span><span class=p>,</span> <span class=s2>&quot;bug&quot;</span><span class=p>,</span> <span class=s2>&quot;broken&quot;</span><span class=p>,</span> <span class=s2>&quot;crash&quot;</span><span class=p>,</span> <span class=s2>&quot;not working&quot;</span><span class=p>,</span> <span class=s2>&quot;shutting down&quot;</span><span class=p>,</span>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>                         <span class=s2>&quot;frozen&quot;</span><span class=p>,</span> <span class=s2>&quot;blue screen&quot;</span><span class=p>,</span> <span class=s2>&quot;won&#39;t start&quot;</span><span class=p>,</span> <span class=s2>&quot;slow&quot;</span><span class=p>,</span> <span class=s2>&quot;virus&quot;</span><span class=p>]</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>    <span class=k>if</span> <span class=nb>any</span><span class=p>(</span><span class=n>keyword</span> <span class=ow>in</span> <span class=n>query</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>keyword</span> <span class=ow>in</span> <span class=n>technical_keywords</span><span class=p>):</span>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>        <span class=k>return</span> <span class=n>ReplyResult</span><span class=p>(</span>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>            <span class=n>message</span><span class=o>=</span><span class=s2>&quot;This appears to be a technical issue. Let me route you to our tech support team.&quot;</span><span class=p>,</span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>            <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>tech_agent</span><span class=p>),</span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>            <span class=n>context_variables</span><span class=o>=</span><span class=n>context_variables</span>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>        <span class=p>)</span>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>        <span class=k>return</span> <span class=n>ReplyResult</span><span class=p>(</span>
<a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a>            <span class=n>message</span><span class=o>=</span><span class=s2>&quot;This appears to be a general question. Let me connect you with our general support team.&quot;</span><span class=p>,</span>
<a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>            <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>general_agent</span><span class=p>),</span>
<a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a>            <span class=n>context_variables</span><span class=o>=</span><span class=n>context_variables</span>
<a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a>        <span class=p>)</span>
<a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a>
<a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=k>def</span><span class=w> </span><span class=nf>check_repeat_issue</span><span class=p>(</span>
<a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a>    <span class=n>description</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=s2>&quot;User&#39;s description of the continuing issue&quot;</span><span class=p>],</span>
<a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a>    <span class=n>context_variables</span><span class=p>:</span> <span class=n>ContextVariables</span>
<a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ReplyResult</span><span class=p>:</span>
<a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Check if this is a repeat of an issue that wasn&#39;t resolved.&quot;&quot;&quot;</span>
<a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a>    <span class=c1># Mark this as a repeat issue in the context</span>
<a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a>    <span class=n>context_variables</span><span class=p>[</span><span class=s2>&quot;repeat_issue&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a>    <span class=n>context_variables</span><span class=p>[</span><span class=s2>&quot;continuing_issue&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>description</span>
<a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a>
<a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a>    <span class=k>return</span> <span class=n>ReplyResult</span><span class=p>(</span>
<a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a>        <span class=n>message</span><span class=o>=</span><span class=s2>&quot;I understand that your issue wasn&#39;t resolved. Let me connect you with our advanced troubleshooting specialist.&quot;</span><span class=p>,</span>
<a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>advanced_troubleshooting_agent</span><span class=p>),</span>
<a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a>        <span class=n>context_variables</span><span class=o>=</span><span class=n>context_variables</span>
<a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a>    <span class=p>)</span>
<a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a>
<a id=__codelineno-8-42 name=__codelineno-8-42 href=#__codelineno-8-42></a><span class=c1># Add tool functions to the appropriate agents</span>
<a id=__codelineno-8-43 name=__codelineno-8-43 href=#__codelineno-8-43></a><span class=n>triage_agent</span><span class=o>.</span><span class=n>functions</span> <span class=o>=</span> <span class=p>[</span><span class=n>classify_query</span><span class=p>]</span>
<a id=__codelineno-8-44 name=__codelineno-8-44 href=#__codelineno-8-44></a><span class=n>computer_agent</span><span class=o>.</span><span class=n>functions</span> <span class=o>=</span> <span class=p>[</span><span class=n>check_repeat_issue</span><span class=p>]</span>
<a id=__codelineno-8-45 name=__codelineno-8-45 href=#__codelineno-8-45></a><span class=n>smartphone_agent</span><span class=o>.</span><span class=n>functions</span> <span class=o>=</span> <span class=p>[</span><span class=n>check_repeat_issue</span><span class=p>]</span>
</code></pre></div> <h3 id=configuring-llm-based-handoffs>Configuring LLM-Based Handoffs<a class=headerlink href=#configuring-llm-based-handoffs title="Permanent link">#</a></h3> <p>Our first type of handoff uses the LLM to analyze messages and route based on content. The tech agent uses this to route device-specific issues:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># Route based on device type using LLM-based handoffs</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=n>tech_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>add_llm_conditions</span><span class=p>([</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=hll>    <span class=n>OnCondition</span><span class=p>(</span>
</span><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=hll>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>computer_agent</span><span class=p>),</span>
</span><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=hll>        <span class=n>condition</span><span class=o>=</span><span class=n>StringLLMCondition</span><span class=p>(</span><span class=n>prompt</span><span class=o>=</span><span class=s2>&quot;Route to computer specialist when the issue involves laptops, desktops, PCs, or Macs.&quot;</span><span class=p>),</span>
</span><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=hll>    <span class=p>),</span>
</span><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=hll>    <span class=n>OnCondition</span><span class=p>(</span>
</span><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=hll>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>smartphone_agent</span><span class=p>),</span>
</span><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=hll>        <span class=n>condition</span><span class=o>=</span><span class=n>StringLLMCondition</span><span class=p>(</span><span class=n>prompt</span><span class=o>=</span><span class=s2>&quot;Route to smartphone specialist when the issue involves phones, mobile devices, iOS, or Android.&quot;</span><span class=p>),</span>
</span><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=hll>    <span class=p>)</span>
</span><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=p>])</span>
</code></pre></div> <p>With these LLM-based handoffs, the tech agent analyzes the user's message to identify if they're discussing a computer or smartphone issue, then routes accordingly. The LLM evaluates the prompt against the conversation content to make this decision.</p> <pre class=mermaid><code>flowchart TD
    Tech[Tech Agent] --&gt;|"LLM analyzes: Computer issue?"| Computer[Computer Agent]
    Tech --&gt;|"LLM analyzes: Smartphone issue?"| Smartphone[Smartphone Agent]
    Tech --&gt;|"Neither condition met"| User([User])

    style Tech fill:#e8f5e9,stroke:#4caf50
    style Computer fill:#d1c4e9,stroke:#673ab7
    style Smartphone fill:#bbdefb,stroke:#2196f3
    style User fill:#f9f9f9,stroke:#333</code></pre> <h3 id=configuring-context-based-handoffs>Configuring Context-Based Handoffs<a class=headerlink href=#configuring-context-based-handoffs title="Permanent link">#</a></h3> <p>Context-based handoffs make decisions based on the state of the conversation rather than message content. We use these to detect when a customer returns with the same issue:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># Configure handoffs for computer agent - for repeat issues</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>computer_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>add_context_conditions</span><span class=p>([</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    <span class=n>OnContextCondition</span><span class=p>(</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>advanced_troubleshooting_agent</span><span class=p>),</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=hll>        <span class=n>condition</span><span class=o>=</span><span class=n>ExpressionContextCondition</span><span class=p>(</span>
</span><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=hll>            <span class=n>expression</span><span class=o>=</span><span class=n>ContextExpression</span><span class=p>(</span><span class=s2>&quot;$</span><span class=si>{repeat_issue}</span><span class=s2> == True&quot;</span><span class=p>)</span>
</span><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=hll>        <span class=p>)</span>
</span><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>    <span class=p>)</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=p>])</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=c1># Similarly for smartphone agent</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=n>smartphone_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>add_context_conditions</span><span class=p>([</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>    <span class=n>OnContextCondition</span><span class=p>(</span>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>advanced_troubleshooting_agent</span><span class=p>),</span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=hll>        <span class=n>condition</span><span class=o>=</span><span class=n>ExpressionContextCondition</span><span class=p>(</span>
</span><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=hll>            <span class=n>expression</span><span class=o>=</span><span class=n>ContextExpression</span><span class=p>(</span><span class=s2>&quot;$</span><span class=si>{repeat_issue}</span><span class=s2> == True&quot;</span><span class=p>)</span>
</span><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=hll>        <span class=p>)</span>
</span><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>    <span class=p>)</span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=p>])</span>
</code></pre></div> <p>These context-based handoffs check if <code>repeat_issue</code> is set to <code>True</code> in the context variables. When a user says their issue wasn't solved, the <code>check_repeat_issue</code> tool sets this flag, and the handoff condition triggers a transfer to advanced troubleshooting.</p> <pre class=mermaid><code>flowchart TD
    Computer[Computer Agent] --&gt;|"Context check: repeat_issue == True"| Advanced[Advanced Troubleshooting]
    Computer ----&gt;|"First-time issue"| User([User])
    Smartphone[Smartphone Agent] ----&gt;|"Context check: repeat_issue == True"| Advanced
    Smartphone ----&gt;|"First-time issue"| User

    style Computer fill:#d1c4e9,stroke:#673ab7
    style Smartphone fill:#bbdefb,stroke:#2196f3
    style Advanced fill:#ffccbc,stroke:#e64a19
    style User fill:#f9f9f9,stroke:#333</code></pre> <h3 id=setting-default-after-work-behavior>Setting Default After-Work Behavior<a class=headerlink href=#setting-default-after-work-behavior title="Permanent link">#</a></h3> <p>After-work behavior defines what happens when an agent completes its work and no specific LLM or context-based handoff conditions are triggered. AG2 provides two levels of control for setting after-work behavior: <strong>agent-level</strong> and <strong>pattern-level</strong>.</p> <h4 id=agent-level-after-work-behavior>Agent-Level After-Work Behavior<a class=headerlink href=#agent-level-after-work-behavior title="Permanent link">#</a></h4> <p>You can set the after-work behavior for an agent using the <code>set_after_work</code> method. This method takes a <code>Target</code> object as an argument, which defines what happens when the agent completes its work.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># Configure handoffs for advanced troubleshooting agent</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=n>advanced_troubleshooting_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>set_after_work</span><span class=p>(</span><span class=n>RevertToUserTarget</span><span class=p>())</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=c1># General agent reverts to user after helping</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=n>general_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>set_after_work</span><span class=p>(</span><span class=n>RevertToUserTarget</span><span class=p>())</span>
</code></pre></div> <p>This approach is ideal when different agents in your system need different behaviors after completing their tasks.</p> <h4 id=pattern-level-after-work-behavior>Pattern-Level After-Work Behavior<a class=headerlink href=#pattern-level-after-work-behavior title="Permanent link">#</a></h4> <p>Pattern-level after-work behavior sets a default behavior for all agents in the group chat using the <code>group_after_work</code> parameter:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># Set pattern-level after-work behavior that applies to all agents</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=n>pattern</span> <span class=o>=</span> <span class=n>DefaultPattern</span><span class=p>(</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=n>initial_agent</span><span class=o>=</span><span class=n>triage_agent</span><span class=p>,</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>    <span class=n>agents</span><span class=o>=</span><span class=p>[</span><span class=n>triage_agent</span><span class=p>,</span> <span class=n>tech_agent</span><span class=p>,</span> <span class=n>general_agent</span><span class=p>],</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>    <span class=n>user_agent</span><span class=o>=</span><span class=n>user</span><span class=p>,</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>    <span class=n>group_manager_args</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;llm_config&quot;</span><span class=p>:</span> <span class=n>llm_config</span><span class=p>},</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>    <span class=n>group_after_work</span><span class=o>=</span><span class=n>RevertToUserTarget</span><span class=p>()</span>  <span class=c1># All agents revert to user when done</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=p>)</span>
</code></pre></div> <p>This approach is useful when you want consistent behavior across all agents in your system, reducing the need to configure each agent individually.</p> <h4 id=precedence-and-override-behavior>Precedence and Override Behavior<a class=headerlink href=#precedence-and-override-behavior title="Permanent link">#</a></h4> <p>When both agent-level and pattern-level after-work behaviors are set, agent-level settings take precedence:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1># Pattern-level setting applies to all agents</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=n>pattern</span> <span class=o>=</span> <span class=n>AutoPattern</span><span class=p>(</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>    <span class=n>initial_agent</span><span class=o>=</span><span class=n>triage_agent</span><span class=p>,</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>    <span class=n>agents</span><span class=o>=</span><span class=p>[</span><span class=n>triage_agent</span><span class=p>,</span> <span class=n>tech_agent</span><span class=p>,</span> <span class=n>general_agent</span><span class=p>],</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>    <span class=n>user_agent</span><span class=o>=</span><span class=n>user</span><span class=p>,</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>    <span class=n>group_after_work</span><span class=o>=</span><span class=n>RevertToUserTarget</span><span class=p>()</span>  <span class=c1># Default for all agents</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=p>)</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=c1># Agent-level setting overrides pattern-level for this specific agent</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=n>tech_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>set_after_work</span><span class=p>(</span><span class=n>TerminateTarget</span><span class=p>())</span>  <span class=c1># This overrides the pattern setting</span>
</code></pre></div> <p>In this example, <code>triage_agent</code> and <code>general_agent</code> will revert to the user after completing their work, while <code>tech_agent</code> will terminate the conversation.</p> <p>The <code>group_after_work</code> parameter accepts any of the <a href=../handoffs/#transition-targets>transition targets</a> available in AG2.</p> <h4 id=choosing-the-right-approach>Choosing the Right Approach<a class=headerlink href=#choosing-the-right-approach title="Permanent link">#</a></h4> <p>Use <code>agent-level</code> after-work behavior when:</p> <ul> <li>Different agents need different behaviors after completing their tasks</li> <li>You want fine-grained control over conversation flow</li> <li>Some agents should terminate while others should continue the conversation</li> </ul> <p>Use <code>pattern-level</code> after-work behavior when:</p> <ul> <li>You want consistent behavior across all agents</li> <li>You're setting up a simple workflow where all agents should behave similarly</li> <li>You want to minimize configuration overhead</li> </ul> <h3 id=putting-it-all-together>Putting It All Together<a class=headerlink href=#putting-it-all-together title="Permanent link">#</a></h3> <p>Now we can set up the conversation pattern and run the chat:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># Create the user agent</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=n>user</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;ALWAYS&quot;</span><span class=p>)</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=c1># Set up the conversation pattern</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=n>pattern</span> <span class=o>=</span> <span class=n>AutoPattern</span><span class=p>(</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>    <span class=n>initial_agent</span><span class=o>=</span><span class=n>triage_agent</span><span class=p>,</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>    <span class=n>agents</span><span class=o>=</span><span class=p>[</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>        <span class=n>triage_agent</span><span class=p>,</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>        <span class=n>tech_agent</span><span class=p>,</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>        <span class=n>computer_agent</span><span class=p>,</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>        <span class=n>smartphone_agent</span><span class=p>,</span>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a>        <span class=n>advanced_troubleshooting_agent</span><span class=p>,</span>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>        <span class=n>general_agent</span>
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>    <span class=p>],</span>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>    <span class=n>user_agent</span><span class=o>=</span><span class=n>user</span><span class=p>,</span>
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>    <span class=n>context_variables</span><span class=o>=</span><span class=n>support_context</span><span class=p>,</span>
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>    <span class=n>group_manager_args</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;llm_config&quot;</span><span class=p>:</span> <span class=n>llm_config</span><span class=p>},</span>
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=p>)</span>
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a>
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=c1># Run the chat</span>
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=n>result</span><span class=p>,</span> <span class=n>final_context</span><span class=p>,</span> <span class=n>last_agent</span> <span class=o>=</span> <span class=n>initiate_group_chat</span><span class=p>(</span>
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a>    <span class=n>pattern</span><span class=o>=</span><span class=n>pattern</span><span class=p>,</span>
<a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a>    <span class=n>messages</span><span class=o>=</span><span class=s2>&quot;My laptop keeps shutting down randomly. Can you help?&quot;</span><span class=p>,</span>
<a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a>    <span class=n>max_rounds</span><span class=o>=</span><span class=mi>15</span>
<a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=p>)</span>
</code></pre></div> <p>By combining different handoff types, we've created a support system that can:</p> <ul> <li>Route based on message content (LLM-based handoffs)</li> <li>Route based on conversation state (context-based handoffs)</li> <li>Provide fallback behaviors when no conditions are met (after-work)</li> <li>Use tools to update context and influence routing</li> </ul> <h3 id=complete-example>Complete Example<a class=headerlink href=#complete-example title="Permanent link">#</a></h3> <details class=info open=open> <summary>Complete Code Example</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Annotated</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat</span><span class=w> </span><span class=kn>import</span> <span class=n>initiate_group_chat</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat.group.patterns</span><span class=w> </span><span class=kn>import</span> <span class=n>AutoPattern</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat.group</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>    <span class=n>ContextVariables</span><span class=p>,</span> <span class=n>ReplyResult</span><span class=p>,</span> <span class=n>AgentTarget</span><span class=p>,</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>    <span class=n>OnCondition</span><span class=p>,</span> <span class=n>StringLLMCondition</span><span class=p>,</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>    <span class=n>OnContextCondition</span><span class=p>,</span> <span class=n>ExpressionContextCondition</span><span class=p>,</span> <span class=n>ContextExpression</span><span class=p>,</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>    <span class=n>RevertToUserTarget</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=p>)</span>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=c1># Initialize context variables for our support system</span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=n>support_context</span> <span class=o>=</span> <span class=n>ContextVariables</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=p>{</span>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>    <span class=s2>&quot;query_count&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>    <span class=s2>&quot;repeat_issue&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>    <span class=s2>&quot;previous_solutions&quot;</span><span class=p>:</span> <span class=p>[],</span>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a>    <span class=s2>&quot;issue_type&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a>    <span class=s2>&quot;issue_subtype&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=p>})</span>
<a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a>
<a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=c1># Configure the LLM</span>
<a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>(</span><span class=n>api_type</span><span class=o>=</span><span class=s2>&quot;openai&quot;</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=s2>&quot;gpt-4o-mini&quot;</span><span class=p>)</span>
<a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a>
<a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=c1># Create all our support agents</span>
<a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a><span class=k>with</span> <span class=n>llm_config</span><span class=p>:</span>
<a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a>    <span class=c1># Main triage agent - the starting point for all user queries</span>
<a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a>    <span class=n>triage_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;triage_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are a support triage agent. Your role is to:</span>
<a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a><span class=s2>        1. Determine if a query is technical or general</span>
<a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a><span class=s2>        2. Use the classify_query function to route appropriately</span>
<a id=__codelineno-15-32 name=__codelineno-15-32 href=#__codelineno-15-32></a>
<a id=__codelineno-15-33 name=__codelineno-15-33 href=#__codelineno-15-33></a><span class=s2>        Do not attempt to solve issues yourself - your job is proper routing.&quot;&quot;&quot;</span>
<a id=__codelineno-15-34 name=__codelineno-15-34 href=#__codelineno-15-34></a>    <span class=p>)</span>
<a id=__codelineno-15-35 name=__codelineno-15-35 href=#__codelineno-15-35></a>
<a id=__codelineno-15-36 name=__codelineno-15-36 href=#__codelineno-15-36></a>    <span class=c1># General support for non-technical questions</span>
<a id=__codelineno-15-37 name=__codelineno-15-37 href=#__codelineno-15-37></a>    <span class=n>general_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-15-38 name=__codelineno-15-38 href=#__codelineno-15-38></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;general_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-15-39 name=__codelineno-15-39 href=#__codelineno-15-39></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are a general support agent who handles non-technical questions.</span>
<a id=__codelineno-15-40 name=__codelineno-15-40 href=#__codelineno-15-40></a><span class=s2>        If the user is a premium customer (check account_tier context variable),</span>
<a id=__codelineno-15-41 name=__codelineno-15-41 href=#__codelineno-15-41></a><span class=s2>        you should transfer them directly to the premium support agent.</span>
<a id=__codelineno-15-42 name=__codelineno-15-42 href=#__codelineno-15-42></a><span class=s2>        Otherwise, provide helpful responses to general inquiries.&quot;&quot;&quot;</span>
<a id=__codelineno-15-43 name=__codelineno-15-43 href=#__codelineno-15-43></a>    <span class=p>)</span>
<a id=__codelineno-15-44 name=__codelineno-15-44 href=#__codelineno-15-44></a>
<a id=__codelineno-15-45 name=__codelineno-15-45 href=#__codelineno-15-45></a>    <span class=c1># Tech agent for initial technical assessment</span>
<a id=__codelineno-15-46 name=__codelineno-15-46 href=#__codelineno-15-46></a>    <span class=n>tech_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-15-47 name=__codelineno-15-47 href=#__codelineno-15-47></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;tech_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-15-48 name=__codelineno-15-48 href=#__codelineno-15-48></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are a technical support agent who handles the initial assessment</span>
<a id=__codelineno-15-49 name=__codelineno-15-49 href=#__codelineno-15-49></a><span class=s2>        of all technical issues.</span>
<a id=__codelineno-15-50 name=__codelineno-15-50 href=#__codelineno-15-50></a>
<a id=__codelineno-15-51 name=__codelineno-15-51 href=#__codelineno-15-51></a><span class=s2>        If the user is a premium customer (check account_tier context variable),</span>
<a id=__codelineno-15-52 name=__codelineno-15-52 href=#__codelineno-15-52></a><span class=s2>        you should transfer them directly to the premium support agent.</span>
<a id=__codelineno-15-53 name=__codelineno-15-53 href=#__codelineno-15-53></a>
<a id=__codelineno-15-54 name=__codelineno-15-54 href=#__codelineno-15-54></a><span class=s2>        Otherwise, determine if the issue is related to:</span>
<a id=__codelineno-15-55 name=__codelineno-15-55 href=#__codelineno-15-55></a><span class=s2>        - Computer issues (laptops, desktops, PCs, Macs)</span>
<a id=__codelineno-15-56 name=__codelineno-15-56 href=#__codelineno-15-56></a><span class=s2>        - Smartphone issues (iPhones, Android phones, tablets)</span>
<a id=__codelineno-15-57 name=__codelineno-15-57 href=#__codelineno-15-57></a>
<a id=__codelineno-15-58 name=__codelineno-15-58 href=#__codelineno-15-58></a><span class=s2>        And route to the appropriate specialist.&quot;&quot;&quot;</span>
<a id=__codelineno-15-59 name=__codelineno-15-59 href=#__codelineno-15-59></a>    <span class=p>)</span>
<a id=__codelineno-15-60 name=__codelineno-15-60 href=#__codelineno-15-60></a>
<a id=__codelineno-15-61 name=__codelineno-15-61 href=#__codelineno-15-61></a>    <span class=c1># Device-specific agents</span>
<a id=__codelineno-15-62 name=__codelineno-15-62 href=#__codelineno-15-62></a>    <span class=n>computer_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-15-63 name=__codelineno-15-63 href=#__codelineno-15-63></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;computer_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-15-64 name=__codelineno-15-64 href=#__codelineno-15-64></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are a computer specialist who handles issues with laptops, desktops,</span>
<a id=__codelineno-15-65 name=__codelineno-15-65 href=#__codelineno-15-65></a><span class=s2>        PCs, and Macs. You provide troubleshooting for hardware and software issues specific to</span>
<a id=__codelineno-15-66 name=__codelineno-15-66 href=#__codelineno-15-66></a><span class=s2>        computers. You&#39;re knowledgeable about Windows, macOS, Linux, and common computer peripherals.</span>
<a id=__codelineno-15-67 name=__codelineno-15-67 href=#__codelineno-15-67></a>
<a id=__codelineno-15-68 name=__codelineno-15-68 href=#__codelineno-15-68></a><span class=s2>        For first-time issues, provide a solution directly.</span>
<a id=__codelineno-15-69 name=__codelineno-15-69 href=#__codelineno-15-69></a>
<a id=__codelineno-15-70 name=__codelineno-15-70 href=#__codelineno-15-70></a><span class=s2>        If a user returns and says they tried your solution but are still having the issue,</span>
<a id=__codelineno-15-71 name=__codelineno-15-71 href=#__codelineno-15-71></a><span class=s2>        use the check_repeat_issue function to escalate to advanced troubleshooting. Do not provide a solution yourself for returning users, simply route it to advanced troubleshooting.&quot;&quot;&quot;</span>
<a id=__codelineno-15-72 name=__codelineno-15-72 href=#__codelineno-15-72></a>    <span class=p>)</span>
<a id=__codelineno-15-73 name=__codelineno-15-73 href=#__codelineno-15-73></a>
<a id=__codelineno-15-74 name=__codelineno-15-74 href=#__codelineno-15-74></a>    <span class=n>smartphone_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-15-75 name=__codelineno-15-75 href=#__codelineno-15-75></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;smartphone_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-15-76 name=__codelineno-15-76 href=#__codelineno-15-76></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are a smartphone specialist who handles issues with mobile devices</span>
<a id=__codelineno-15-77 name=__codelineno-15-77 href=#__codelineno-15-77></a><span class=s2>        including iPhones, Android phones, and tablets. You&#39;re knowledgeable about iOS, Android,</span>
<a id=__codelineno-15-78 name=__codelineno-15-78 href=#__codelineno-15-78></a><span class=s2>        mobile apps, battery issues, screen problems, and connectivity troubleshooting.</span>
<a id=__codelineno-15-79 name=__codelineno-15-79 href=#__codelineno-15-79></a>
<a id=__codelineno-15-80 name=__codelineno-15-80 href=#__codelineno-15-80></a><span class=s2>        For first-time issues, provide a solution directly.</span>
<a id=__codelineno-15-81 name=__codelineno-15-81 href=#__codelineno-15-81></a>
<a id=__codelineno-15-82 name=__codelineno-15-82 href=#__codelineno-15-82></a><span class=s2>        If a user returns and says they tried your solution but are still having the issue,</span>
<a id=__codelineno-15-83 name=__codelineno-15-83 href=#__codelineno-15-83></a><span class=s2>        use the check_repeat_issue function to escalate to advanced troubleshooting. Do not provide a solution yourself for returning users, simply route it to advanced troubleshooting&quot;&quot;&quot;</span>
<a id=__codelineno-15-84 name=__codelineno-15-84 href=#__codelineno-15-84></a>    <span class=p>)</span>
<a id=__codelineno-15-85 name=__codelineno-15-85 href=#__codelineno-15-85></a>
<a id=__codelineno-15-86 name=__codelineno-15-86 href=#__codelineno-15-86></a>    <span class=c1># Advanced troubleshooting for complex issues</span>
<a id=__codelineno-15-87 name=__codelineno-15-87 href=#__codelineno-15-87></a>    <span class=n>advanced_troubleshooting_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-15-88 name=__codelineno-15-88 href=#__codelineno-15-88></a>        <span class=n>name</span><span class=o>=</span><span class=s2>&quot;advanced_troubleshooting_agent&quot;</span><span class=p>,</span>
<a id=__codelineno-15-89 name=__codelineno-15-89 href=#__codelineno-15-89></a>        <span class=n>system_message</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are an advanced troubleshooting specialist who handles complex,</span>
<a id=__codelineno-15-90 name=__codelineno-15-90 href=#__codelineno-15-90></a><span class=s2>        persistent issues that weren&#39;t resolved by initial solutions. You provide deeper</span>
<a id=__codelineno-15-91 name=__codelineno-15-91 href=#__codelineno-15-91></a><span class=s2>        diagnostic approaches and more comprehensive solutions for difficult technical problems.&quot;&quot;&quot;</span>
<a id=__codelineno-15-92 name=__codelineno-15-92 href=#__codelineno-15-92></a>    <span class=p>)</span>
<a id=__codelineno-15-93 name=__codelineno-15-93 href=#__codelineno-15-93></a>
<a id=__codelineno-15-94 name=__codelineno-15-94 href=#__codelineno-15-94></a><span class=c1># Define tool functions</span>
<a id=__codelineno-15-95 name=__codelineno-15-95 href=#__codelineno-15-95></a><span class=k>def</span><span class=w> </span><span class=nf>classify_query</span><span class=p>(</span>
<a id=__codelineno-15-96 name=__codelineno-15-96 href=#__codelineno-15-96></a>    <span class=n>query</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=s2>&quot;The user query to classify&quot;</span><span class=p>],</span>
<a id=__codelineno-15-97 name=__codelineno-15-97 href=#__codelineno-15-97></a>    <span class=n>context_variables</span><span class=p>:</span> <span class=n>ContextVariables</span>
<a id=__codelineno-15-98 name=__codelineno-15-98 href=#__codelineno-15-98></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ReplyResult</span><span class=p>:</span>
<a id=__codelineno-15-99 name=__codelineno-15-99 href=#__codelineno-15-99></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Classify a user query and route to the appropriate agent.&quot;&quot;&quot;</span>
<a id=__codelineno-15-100 name=__codelineno-15-100 href=#__codelineno-15-100></a>    <span class=c1># Update query count</span>
<a id=__codelineno-15-101 name=__codelineno-15-101 href=#__codelineno-15-101></a>    <span class=n>context_variables</span><span class=p>[</span><span class=s2>&quot;query_count&quot;</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
<a id=__codelineno-15-102 name=__codelineno-15-102 href=#__codelineno-15-102></a>
<a id=__codelineno-15-103 name=__codelineno-15-103 href=#__codelineno-15-103></a>    <span class=c1># Simple classification logic</span>
<a id=__codelineno-15-104 name=__codelineno-15-104 href=#__codelineno-15-104></a>    <span class=n>technical_keywords</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;error&quot;</span><span class=p>,</span> <span class=s2>&quot;bug&quot;</span><span class=p>,</span> <span class=s2>&quot;broken&quot;</span><span class=p>,</span> <span class=s2>&quot;crash&quot;</span><span class=p>,</span> <span class=s2>&quot;not working&quot;</span><span class=p>,</span> <span class=s2>&quot;shutting down&quot;</span><span class=p>,</span>
<a id=__codelineno-15-105 name=__codelineno-15-105 href=#__codelineno-15-105></a>                        <span class=s2>&quot;frozen&quot;</span><span class=p>,</span> <span class=s2>&quot;blue screen&quot;</span><span class=p>,</span> <span class=s2>&quot;won&#39;t start&quot;</span><span class=p>,</span> <span class=s2>&quot;slow&quot;</span><span class=p>,</span> <span class=s2>&quot;virus&quot;</span><span class=p>]</span>
<a id=__codelineno-15-106 name=__codelineno-15-106 href=#__codelineno-15-106></a>
<a id=__codelineno-15-107 name=__codelineno-15-107 href=#__codelineno-15-107></a>    <span class=k>if</span> <span class=nb>any</span><span class=p>(</span><span class=n>keyword</span> <span class=ow>in</span> <span class=n>query</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>keyword</span> <span class=ow>in</span> <span class=n>technical_keywords</span><span class=p>):</span>
<a id=__codelineno-15-108 name=__codelineno-15-108 href=#__codelineno-15-108></a>        <span class=k>return</span> <span class=n>ReplyResult</span><span class=p>(</span>
<a id=__codelineno-15-109 name=__codelineno-15-109 href=#__codelineno-15-109></a>            <span class=n>message</span><span class=o>=</span><span class=s2>&quot;This appears to be a technical issue. Let me route you to our tech support team.&quot;</span><span class=p>,</span>
<a id=__codelineno-15-110 name=__codelineno-15-110 href=#__codelineno-15-110></a>            <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>tech_agent</span><span class=p>),</span>
<a id=__codelineno-15-111 name=__codelineno-15-111 href=#__codelineno-15-111></a>            <span class=n>context_variables</span><span class=o>=</span><span class=n>context_variables</span>
<a id=__codelineno-15-112 name=__codelineno-15-112 href=#__codelineno-15-112></a>        <span class=p>)</span>
<a id=__codelineno-15-113 name=__codelineno-15-113 href=#__codelineno-15-113></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-15-114 name=__codelineno-15-114 href=#__codelineno-15-114></a>        <span class=k>return</span> <span class=n>ReplyResult</span><span class=p>(</span>
<a id=__codelineno-15-115 name=__codelineno-15-115 href=#__codelineno-15-115></a>            <span class=n>message</span><span class=o>=</span><span class=s2>&quot;This appears to be a general question. Let me connect you with our general support team.&quot;</span><span class=p>,</span>
<a id=__codelineno-15-116 name=__codelineno-15-116 href=#__codelineno-15-116></a>            <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>general_agent</span><span class=p>),</span>
<a id=__codelineno-15-117 name=__codelineno-15-117 href=#__codelineno-15-117></a>            <span class=n>context_variables</span><span class=o>=</span><span class=n>context_variables</span>
<a id=__codelineno-15-118 name=__codelineno-15-118 href=#__codelineno-15-118></a>        <span class=p>)</span>
<a id=__codelineno-15-119 name=__codelineno-15-119 href=#__codelineno-15-119></a>
<a id=__codelineno-15-120 name=__codelineno-15-120 href=#__codelineno-15-120></a><span class=k>def</span><span class=w> </span><span class=nf>check_repeat_issue</span><span class=p>(</span>
<a id=__codelineno-15-121 name=__codelineno-15-121 href=#__codelineno-15-121></a>    <span class=n>description</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=s2>&quot;User&#39;s description of the continuing issue&quot;</span><span class=p>],</span>
<a id=__codelineno-15-122 name=__codelineno-15-122 href=#__codelineno-15-122></a>    <span class=n>context_variables</span><span class=p>:</span> <span class=n>ContextVariables</span>
<a id=__codelineno-15-123 name=__codelineno-15-123 href=#__codelineno-15-123></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ReplyResult</span><span class=p>:</span>
<a id=__codelineno-15-124 name=__codelineno-15-124 href=#__codelineno-15-124></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Check if this is a repeat of an issue that wasn&#39;t resolved.&quot;&quot;&quot;</span>
<a id=__codelineno-15-125 name=__codelineno-15-125 href=#__codelineno-15-125></a>    <span class=c1># Mark this as a repeat issue in the context</span>
<a id=__codelineno-15-126 name=__codelineno-15-126 href=#__codelineno-15-126></a>    <span class=n>context_variables</span><span class=p>[</span><span class=s2>&quot;repeat_issue&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-15-127 name=__codelineno-15-127 href=#__codelineno-15-127></a>    <span class=n>context_variables</span><span class=p>[</span><span class=s2>&quot;continuing_issue&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>description</span>
<a id=__codelineno-15-128 name=__codelineno-15-128 href=#__codelineno-15-128></a>
<a id=__codelineno-15-129 name=__codelineno-15-129 href=#__codelineno-15-129></a>    <span class=k>return</span> <span class=n>ReplyResult</span><span class=p>(</span>
<a id=__codelineno-15-130 name=__codelineno-15-130 href=#__codelineno-15-130></a>        <span class=n>message</span><span class=o>=</span><span class=s2>&quot;I understand that your issue wasn&#39;t resolved. Let me connect you with our advanced troubleshooting specialist.&quot;</span><span class=p>,</span>
<a id=__codelineno-15-131 name=__codelineno-15-131 href=#__codelineno-15-131></a>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>advanced_troubleshooting_agent</span><span class=p>),</span>
<a id=__codelineno-15-132 name=__codelineno-15-132 href=#__codelineno-15-132></a>        <span class=n>context_variables</span><span class=o>=</span><span class=n>context_variables</span>
<a id=__codelineno-15-133 name=__codelineno-15-133 href=#__codelineno-15-133></a>    <span class=p>)</span>
<a id=__codelineno-15-134 name=__codelineno-15-134 href=#__codelineno-15-134></a>
<a id=__codelineno-15-135 name=__codelineno-15-135 href=#__codelineno-15-135></a><span class=c1># Add tool functions to the appropriate agents</span>
<a id=__codelineno-15-136 name=__codelineno-15-136 href=#__codelineno-15-136></a><span class=n>triage_agent</span><span class=o>.</span><span class=n>functions</span> <span class=o>=</span> <span class=p>[</span><span class=n>classify_query</span><span class=p>]</span>
<a id=__codelineno-15-137 name=__codelineno-15-137 href=#__codelineno-15-137></a><span class=n>computer_agent</span><span class=o>.</span><span class=n>functions</span> <span class=o>=</span> <span class=p>[</span><span class=n>check_repeat_issue</span><span class=p>]</span>
<a id=__codelineno-15-138 name=__codelineno-15-138 href=#__codelineno-15-138></a><span class=n>smartphone_agent</span><span class=o>.</span><span class=n>functions</span> <span class=o>=</span> <span class=p>[</span><span class=n>check_repeat_issue</span><span class=p>]</span>
<a id=__codelineno-15-139 name=__codelineno-15-139 href=#__codelineno-15-139></a>
<a id=__codelineno-15-140 name=__codelineno-15-140 href=#__codelineno-15-140></a><span class=c1># Route based on device type</span>
<a id=__codelineno-15-141 name=__codelineno-15-141 href=#__codelineno-15-141></a><span class=n>tech_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>add_llm_conditions</span><span class=p>([</span>
<a id=__codelineno-15-142 name=__codelineno-15-142 href=#__codelineno-15-142></a>    <span class=n>OnCondition</span><span class=p>(</span>
<a id=__codelineno-15-143 name=__codelineno-15-143 href=#__codelineno-15-143></a>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>computer_agent</span><span class=p>),</span>
<a id=__codelineno-15-144 name=__codelineno-15-144 href=#__codelineno-15-144></a>        <span class=n>condition</span><span class=o>=</span><span class=n>StringLLMCondition</span><span class=p>(</span><span class=n>prompt</span><span class=o>=</span><span class=s2>&quot;Route to computer specialist when the issue involves laptops, desktops, PCs, or Macs.&quot;</span><span class=p>),</span>
<a id=__codelineno-15-145 name=__codelineno-15-145 href=#__codelineno-15-145></a>    <span class=p>),</span>
<a id=__codelineno-15-146 name=__codelineno-15-146 href=#__codelineno-15-146></a>    <span class=n>OnCondition</span><span class=p>(</span>
<a id=__codelineno-15-147 name=__codelineno-15-147 href=#__codelineno-15-147></a>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>smartphone_agent</span><span class=p>),</span>
<a id=__codelineno-15-148 name=__codelineno-15-148 href=#__codelineno-15-148></a>        <span class=n>condition</span><span class=o>=</span><span class=n>StringLLMCondition</span><span class=p>(</span><span class=n>prompt</span><span class=o>=</span><span class=s2>&quot;Route to smartphone specialist when the issue involves phones, mobile devices, iOS, or Android.&quot;</span><span class=p>),</span>
<a id=__codelineno-15-149 name=__codelineno-15-149 href=#__codelineno-15-149></a>    <span class=p>)</span>
<a id=__codelineno-15-150 name=__codelineno-15-150 href=#__codelineno-15-150></a><span class=p>])</span>
<a id=__codelineno-15-151 name=__codelineno-15-151 href=#__codelineno-15-151></a>
<a id=__codelineno-15-152 name=__codelineno-15-152 href=#__codelineno-15-152></a><span class=c1># For other tech issues, revert to user</span>
<a id=__codelineno-15-153 name=__codelineno-15-153 href=#__codelineno-15-153></a><span class=n>tech_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>set_after_work</span><span class=p>(</span><span class=n>RevertToUserTarget</span><span class=p>())</span>
<a id=__codelineno-15-154 name=__codelineno-15-154 href=#__codelineno-15-154></a>
<a id=__codelineno-15-155 name=__codelineno-15-155 href=#__codelineno-15-155></a><span class=c1># Configure handoffs for computer agent - for repeat issues</span>
<a id=__codelineno-15-156 name=__codelineno-15-156 href=#__codelineno-15-156></a><span class=n>computer_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>add_context_conditions</span><span class=p>([</span>
<a id=__codelineno-15-157 name=__codelineno-15-157 href=#__codelineno-15-157></a>    <span class=n>OnContextCondition</span><span class=p>(</span>
<a id=__codelineno-15-158 name=__codelineno-15-158 href=#__codelineno-15-158></a>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>advanced_troubleshooting_agent</span><span class=p>),</span>
<a id=__codelineno-15-159 name=__codelineno-15-159 href=#__codelineno-15-159></a>        <span class=n>condition</span><span class=o>=</span><span class=n>ExpressionContextCondition</span><span class=p>(</span>
<a id=__codelineno-15-160 name=__codelineno-15-160 href=#__codelineno-15-160></a>            <span class=n>expression</span><span class=o>=</span><span class=n>ContextExpression</span><span class=p>(</span><span class=s2>&quot;$</span><span class=si>{repeat_issue}</span><span class=s2> == True&quot;</span><span class=p>)</span>
<a id=__codelineno-15-161 name=__codelineno-15-161 href=#__codelineno-15-161></a>        <span class=p>)</span>
<a id=__codelineno-15-162 name=__codelineno-15-162 href=#__codelineno-15-162></a>    <span class=p>)</span>
<a id=__codelineno-15-163 name=__codelineno-15-163 href=#__codelineno-15-163></a><span class=p>])</span>
<a id=__codelineno-15-164 name=__codelineno-15-164 href=#__codelineno-15-164></a>
<a id=__codelineno-15-165 name=__codelineno-15-165 href=#__codelineno-15-165></a><span class=c1># For first-time issues, revert to user</span>
<a id=__codelineno-15-166 name=__codelineno-15-166 href=#__codelineno-15-166></a><span class=c1># computer_agent.handoffs.set_after_work(RevertToUserTarget())</span>
<a id=__codelineno-15-167 name=__codelineno-15-167 href=#__codelineno-15-167></a>
<a id=__codelineno-15-168 name=__codelineno-15-168 href=#__codelineno-15-168></a><span class=c1># Similarly for smartphone agent</span>
<a id=__codelineno-15-169 name=__codelineno-15-169 href=#__codelineno-15-169></a><span class=n>smartphone_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>add_context_conditions</span><span class=p>([</span>
<a id=__codelineno-15-170 name=__codelineno-15-170 href=#__codelineno-15-170></a>    <span class=n>OnContextCondition</span><span class=p>(</span>
<a id=__codelineno-15-171 name=__codelineno-15-171 href=#__codelineno-15-171></a>        <span class=n>target</span><span class=o>=</span><span class=n>AgentTarget</span><span class=p>(</span><span class=n>advanced_troubleshooting_agent</span><span class=p>),</span>
<a id=__codelineno-15-172 name=__codelineno-15-172 href=#__codelineno-15-172></a>        <span class=n>condition</span><span class=o>=</span><span class=n>ExpressionContextCondition</span><span class=p>(</span>
<a id=__codelineno-15-173 name=__codelineno-15-173 href=#__codelineno-15-173></a>            <span class=n>expression</span><span class=o>=</span><span class=n>ContextExpression</span><span class=p>(</span><span class=s2>&quot;$</span><span class=si>{repeat_issue}</span><span class=s2> == True&quot;</span><span class=p>)</span>
<a id=__codelineno-15-174 name=__codelineno-15-174 href=#__codelineno-15-174></a>        <span class=p>)</span>
<a id=__codelineno-15-175 name=__codelineno-15-175 href=#__codelineno-15-175></a>    <span class=p>)</span>
<a id=__codelineno-15-176 name=__codelineno-15-176 href=#__codelineno-15-176></a><span class=p>])</span>
<a id=__codelineno-15-177 name=__codelineno-15-177 href=#__codelineno-15-177></a><span class=c1># smartphone_agent.handoffs.set_after_work(RevertToUserTarget())</span>
<a id=__codelineno-15-178 name=__codelineno-15-178 href=#__codelineno-15-178></a>
<a id=__codelineno-15-179 name=__codelineno-15-179 href=#__codelineno-15-179></a><span class=c1># Configure handoffs for advanced troubleshooting agent</span>
<a id=__codelineno-15-180 name=__codelineno-15-180 href=#__codelineno-15-180></a><span class=n>advanced_troubleshooting_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>set_after_work</span><span class=p>(</span><span class=n>RevertToUserTarget</span><span class=p>())</span>
<a id=__codelineno-15-181 name=__codelineno-15-181 href=#__codelineno-15-181></a>
<a id=__codelineno-15-182 name=__codelineno-15-182 href=#__codelineno-15-182></a><span class=n>general_agent</span><span class=o>.</span><span class=n>handoffs</span><span class=o>.</span><span class=n>set_after_work</span><span class=p>(</span><span class=n>RevertToUserTarget</span><span class=p>())</span>
<a id=__codelineno-15-183 name=__codelineno-15-183 href=#__codelineno-15-183></a>
<a id=__codelineno-15-184 name=__codelineno-15-184 href=#__codelineno-15-184></a><span class=c1># Create the user agent</span>
<a id=__codelineno-15-185 name=__codelineno-15-185 href=#__codelineno-15-185></a><span class=n>user</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>&quot;ALWAYS&quot;</span><span class=p>)</span>
<a id=__codelineno-15-186 name=__codelineno-15-186 href=#__codelineno-15-186></a>
<a id=__codelineno-15-187 name=__codelineno-15-187 href=#__codelineno-15-187></a><span class=c1># Set up the conversation pattern</span>
<a id=__codelineno-15-188 name=__codelineno-15-188 href=#__codelineno-15-188></a><span class=n>pattern</span> <span class=o>=</span> <span class=n>AutoPattern</span><span class=p>(</span>
<a id=__codelineno-15-189 name=__codelineno-15-189 href=#__codelineno-15-189></a>    <span class=n>initial_agent</span><span class=o>=</span><span class=n>triage_agent</span><span class=p>,</span>
<a id=__codelineno-15-190 name=__codelineno-15-190 href=#__codelineno-15-190></a>    <span class=n>agents</span><span class=o>=</span><span class=p>[</span>
<a id=__codelineno-15-191 name=__codelineno-15-191 href=#__codelineno-15-191></a>        <span class=n>triage_agent</span><span class=p>,</span>
<a id=__codelineno-15-192 name=__codelineno-15-192 href=#__codelineno-15-192></a>        <span class=n>tech_agent</span><span class=p>,</span>
<a id=__codelineno-15-193 name=__codelineno-15-193 href=#__codelineno-15-193></a>        <span class=n>computer_agent</span><span class=p>,</span>
<a id=__codelineno-15-194 name=__codelineno-15-194 href=#__codelineno-15-194></a>        <span class=n>smartphone_agent</span><span class=p>,</span>
<a id=__codelineno-15-195 name=__codelineno-15-195 href=#__codelineno-15-195></a>        <span class=n>advanced_troubleshooting_agent</span><span class=p>,</span>
<a id=__codelineno-15-196 name=__codelineno-15-196 href=#__codelineno-15-196></a>        <span class=n>general_agent</span>
<a id=__codelineno-15-197 name=__codelineno-15-197 href=#__codelineno-15-197></a>    <span class=p>],</span>
<a id=__codelineno-15-198 name=__codelineno-15-198 href=#__codelineno-15-198></a>    <span class=n>user_agent</span><span class=o>=</span><span class=n>user</span><span class=p>,</span>
<a id=__codelineno-15-199 name=__codelineno-15-199 href=#__codelineno-15-199></a>    <span class=n>context_variables</span><span class=o>=</span><span class=n>support_context</span><span class=p>,</span>
<a id=__codelineno-15-200 name=__codelineno-15-200 href=#__codelineno-15-200></a>    <span class=n>group_manager_args</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;llm_config&quot;</span><span class=p>:</span> <span class=n>llm_config</span><span class=p>},</span>
<a id=__codelineno-15-201 name=__codelineno-15-201 href=#__codelineno-15-201></a><span class=p>)</span>
<a id=__codelineno-15-202 name=__codelineno-15-202 href=#__codelineno-15-202></a>
<a id=__codelineno-15-203 name=__codelineno-15-203 href=#__codelineno-15-203></a><span class=c1># Run the chat</span>
<a id=__codelineno-15-204 name=__codelineno-15-204 href=#__codelineno-15-204></a><span class=n>result</span><span class=p>,</span> <span class=n>final_context</span><span class=p>,</span> <span class=n>last_agent</span> <span class=o>=</span> <span class=n>initiate_group_chat</span><span class=p>(</span>
<a id=__codelineno-15-205 name=__codelineno-15-205 href=#__codelineno-15-205></a>    <span class=n>pattern</span><span class=o>=</span><span class=n>pattern</span><span class=p>,</span>
<a id=__codelineno-15-206 name=__codelineno-15-206 href=#__codelineno-15-206></a>    <span class=n>messages</span><span class=o>=</span><span class=s2>&quot;My laptop keeps shutting down randomly. Can you help?&quot;</span><span class=p>,</span>
<a id=__codelineno-15-207 name=__codelineno-15-207 href=#__codelineno-15-207></a>    <span class=n>max_rounds</span><span class=o>=</span><span class=mi>15</span>
<a id=__codelineno-15-208 name=__codelineno-15-208 href=#__codelineno-15-208></a><span class=p>)</span>
</code></pre></div> </details> <h2 id=example-output>Example Output<a class=headerlink href=#example-output title="Permanent link">#</a></h2> <p>If you run the complete example, you should see a conversation flow similar to this:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=go>user (to chat_manager):</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=go>My laptop keeps shutting down randomly. Can you help?</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=go>Next speaker: triage_agent</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=go>triage_agent (to chat_manager):</span>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=go>This sounds like a technical query. I will now classify the query for appropriate routing.</span>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=go>**Classifying query...**</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a>
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=go>Next speaker: tech_agent</span>
<a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a>
<a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=go>tech_agent (to chat_manager):</span>
<a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a>
<a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a><span class=go>***** Suggested tool call (call_tGgsphmvaldi4NpISolDMuqf): transfer_to_computer_agent_1 *****</span>
<a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a><span class=go>Arguments:</span>
<a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a><span class=go>{}</span>
<a id=__codelineno-16-26 name=__codelineno-16-26 href=#__codelineno-16-26></a><span class=go>*********************************************************************************************</span>
<a id=__codelineno-16-27 name=__codelineno-16-27 href=#__codelineno-16-27></a>
<a id=__codelineno-16-28 name=__codelineno-16-28 href=#__codelineno-16-28></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-16-29 name=__codelineno-16-29 href=#__codelineno-16-29></a>
<a id=__codelineno-16-30 name=__codelineno-16-30 href=#__codelineno-16-30></a><span class=go>Next speaker: _Group_Tool_Executor</span>
<a id=__codelineno-16-31 name=__codelineno-16-31 href=#__codelineno-16-31></a>
<a id=__codelineno-16-32 name=__codelineno-16-32 href=#__codelineno-16-32></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; EXECUTING FUNCTION transfer_to_computer_agent_1...</span>
<a id=__codelineno-16-33 name=__codelineno-16-33 href=#__codelineno-16-33></a><span class=go>Call ID: call_tGgsphmvaldi4NpISolDMuqf</span>
<a id=__codelineno-16-34 name=__codelineno-16-34 href=#__codelineno-16-34></a><span class=go>Input arguments: {}</span>
<a id=__codelineno-16-35 name=__codelineno-16-35 href=#__codelineno-16-35></a><span class=go>_Group_Tool_Executor (to chat_manager):</span>
<a id=__codelineno-16-36 name=__codelineno-16-36 href=#__codelineno-16-36></a>
<a id=__codelineno-16-37 name=__codelineno-16-37 href=#__codelineno-16-37></a><span class=go>***** Response from calling tool (call_tGgsphmvaldi4NpISolDMuqf) *****</span>
<a id=__codelineno-16-38 name=__codelineno-16-38 href=#__codelineno-16-38></a><span class=go>Transfer to computer_agent</span>
<a id=__codelineno-16-39 name=__codelineno-16-39 href=#__codelineno-16-39></a><span class=go>**********************************************************************</span>
<a id=__codelineno-16-40 name=__codelineno-16-40 href=#__codelineno-16-40></a>
<a id=__codelineno-16-41 name=__codelineno-16-41 href=#__codelineno-16-41></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-16-42 name=__codelineno-16-42 href=#__codelineno-16-42></a>
<a id=__codelineno-16-43 name=__codelineno-16-43 href=#__codelineno-16-43></a><span class=go>Next speaker: computer_agent</span>
<a id=__codelineno-16-44 name=__codelineno-16-44 href=#__codelineno-16-44></a>
<a id=__codelineno-16-45 name=__codelineno-16-45 href=#__codelineno-16-45></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-16-46 name=__codelineno-16-46 href=#__codelineno-16-46></a><span class=go>computer_agent (to chat_manager):</span>
<a id=__codelineno-16-47 name=__codelineno-16-47 href=#__codelineno-16-47></a>
<a id=__codelineno-16-48 name=__codelineno-16-48 href=#__codelineno-16-48></a><span class=go>It sounds like your laptop may be having a hardware or overheating issue. Here are a few steps you can take to troubleshoot the problem:</span>
<a id=__codelineno-16-49 name=__codelineno-16-49 href=#__codelineno-16-49></a>
<a id=__codelineno-16-50 name=__codelineno-16-50 href=#__codelineno-16-50></a><span class=go>1. **Check for Overheating**: Ensure that the vents of the laptop are not blocked. Use compressed air to clear out dust from the fans and vents.</span>
<a id=__codelineno-16-51 name=__codelineno-16-51 href=#__codelineno-16-51></a>
<a id=__codelineno-16-52 name=__codelineno-16-52 href=#__codelineno-16-52></a><span class=go>2. **Battery Health**: If your laptop has a removable battery, try running it without the battery (only using the power adapter) to see if it still shuts down. If it doesn’t, you may need to replace the battery.</span>
<a id=__codelineno-16-53 name=__codelineno-16-53 href=#__codelineno-16-53></a>
<a id=__codelineno-16-54 name=__codelineno-16-54 href=#__codelineno-16-54></a><span class=go>3. **Power Supply Issues**: Make sure that your power adapter is working properly. Try using a different power adapter that is compatible with your laptop if you have one available.</span>
<a id=__codelineno-16-55 name=__codelineno-16-55 href=#__codelineno-16-55></a>
<a id=__codelineno-16-56 name=__codelineno-16-56 href=#__codelineno-16-56></a><span class=go>4. **Update Drivers and BIOS**: Make sure that all your drivers (especially the chipset and graphics drivers) are up to date, along with the BIOS.</span>
<a id=__codelineno-16-57 name=__codelineno-16-57 href=#__codelineno-16-57></a>
<a id=__codelineno-16-58 name=__codelineno-16-58 href=#__codelineno-16-58></a><span class=go>5. **Run Hardware Diagnostics**: Many laptops come with built-in hardware diagnostics. Check your manufacturer’s website for instructions on how to access and run these tests.</span>
<a id=__codelineno-16-59 name=__codelineno-16-59 href=#__codelineno-16-59></a>
<a id=__codelineno-16-60 name=__codelineno-16-60 href=#__codelineno-16-60></a><span class=go>If these steps don’t resolve the issue, let me know!</span>
<a id=__codelineno-16-61 name=__codelineno-16-61 href=#__codelineno-16-61></a>
<a id=__codelineno-16-62 name=__codelineno-16-62 href=#__codelineno-16-62></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-16-63 name=__codelineno-16-63 href=#__codelineno-16-63></a>
<a id=__codelineno-16-64 name=__codelineno-16-64 href=#__codelineno-16-64></a><span class=go>Next speaker: user</span>
<a id=__codelineno-16-65 name=__codelineno-16-65 href=#__codelineno-16-65></a>
<a id=__codelineno-16-66 name=__codelineno-16-66 href=#__codelineno-16-66></a><span class=go>Replying as user. Provide feedback to chat_manager. Press enter to skip and use auto-reply, or type &#39;exit&#39; to end the conversation: I tried all your suggestions and none of them fixed my issue</span>
<a id=__codelineno-16-67 name=__codelineno-16-67 href=#__codelineno-16-67></a><span class=go>user (to chat_manager):</span>
<a id=__codelineno-16-68 name=__codelineno-16-68 href=#__codelineno-16-68></a>
<a id=__codelineno-16-69 name=__codelineno-16-69 href=#__codelineno-16-69></a><span class=go>I tried all your suggestions and none of them fixed my issue</span>
<a id=__codelineno-16-70 name=__codelineno-16-70 href=#__codelineno-16-70></a>
<a id=__codelineno-16-71 name=__codelineno-16-71 href=#__codelineno-16-71></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-16-72 name=__codelineno-16-72 href=#__codelineno-16-72></a>
<a id=__codelineno-16-73 name=__codelineno-16-73 href=#__codelineno-16-73></a><span class=go>Next speaker: computer_agent</span>
<a id=__codelineno-16-74 name=__codelineno-16-74 href=#__codelineno-16-74></a>
<a id=__codelineno-16-75 name=__codelineno-16-75 href=#__codelineno-16-75></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-16-76 name=__codelineno-16-76 href=#__codelineno-16-76></a><span class=go>computer_agent (to chat_manager):</span>
<a id=__codelineno-16-77 name=__codelineno-16-77 href=#__codelineno-16-77></a>
<a id=__codelineno-16-78 name=__codelineno-16-78 href=#__codelineno-16-78></a><span class=go>It sounds like we need to dive a bit deeper into this issue. I will escalate this to advanced troubleshooting for you. Please hold on while I check for repeat issues.</span>
<a id=__codelineno-16-79 name=__codelineno-16-79 href=#__codelineno-16-79></a>
<a id=__codelineno-16-80 name=__codelineno-16-80 href=#__codelineno-16-80></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-16-81 name=__codelineno-16-81 href=#__codelineno-16-81></a>
<a id=__codelineno-16-82 name=__codelineno-16-82 href=#__codelineno-16-82></a><span class=go>Next speaker: advanced_troubleshooting_agent</span>
<a id=__codelineno-16-83 name=__codelineno-16-83 href=#__codelineno-16-83></a>
<a id=__codelineno-16-84 name=__codelineno-16-84 href=#__codelineno-16-84></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; USING AUTO REPLY...</span>
<a id=__codelineno-16-85 name=__codelineno-16-85 href=#__codelineno-16-85></a><span class=go>advanced_troubleshooting_agent (to chat_manager):</span>
<a id=__codelineno-16-86 name=__codelineno-16-86 href=#__codelineno-16-86></a>
<a id=__codelineno-16-87 name=__codelineno-16-87 href=#__codelineno-16-87></a><span class=go>Thank you for your patience. Since the initial troubleshooting steps didn’t resolve the problem, we can look at more advanced diagnostics to get to the root cause of your laptop shutting down randomly.</span>
<a id=__codelineno-16-88 name=__codelineno-16-88 href=#__codelineno-16-88></a>
<a id=__codelineno-16-89 name=__codelineno-16-89 href=#__codelineno-16-89></a><span class=go>1. **Event Viewer Analysis**:</span>
<a id=__codelineno-16-90 name=__codelineno-16-90 href=#__codelineno-16-90></a><span class=go>   - Open Event Viewer by typing “eventvwr.msc” into the Run dialog (Win + R).</span>
<a id=__codelineno-16-91 name=__codelineno-16-91 href=#__codelineno-16-91></a><span class=go>   - Look for critical errors under &quot;Windows Logs&quot; &gt; &quot;System&quot;. Pay particular attention to events marked with a red exclamation mark that occurred around the time of the shutdown. This might provide insights into whether it’s a hardware failure, kernel panics, or software corruption.</span>
<a id=__codelineno-16-92 name=__codelineno-16-92 href=#__codelineno-16-92></a>
<a id=__codelineno-16-93 name=__codelineno-16-93 href=#__codelineno-16-93></a><span class=go>2. **Temperature Monitoring**:</span>
<a id=__codelineno-16-94 name=__codelineno-16-94 href=#__codelineno-16-94></a><span class=go>   - Use software tools like HWMonitor, Core Temp, or MSI Afterburner to monitor your CPU and GPU temperatures in real time.</span>
<a id=__codelineno-16-95 name=__codelineno-16-95 href=#__codelineno-16-95></a><span class=go>   - If temperatures are significantly above the normal operating range (typically above 80°C under load), then overheating could still be a primary factor, possibly indicating that thermal paste may need to be reapplied on the CPU/GPU or that the cooling system requires professional cleaning or repair.</span>
<a id=__codelineno-16-96 name=__codelineno-16-96 href=#__codelineno-16-96></a>
<a id=__codelineno-16-97 name=__codelineno-16-97 href=#__codelineno-16-97></a><span class=go>3. **Memory Test**:</span>
<a id=__codelineno-16-98 name=__codelineno-16-98 href=#__codelineno-16-98></a><span class=go>   - Run Windows Memory Diagnostic (search for &quot;Windows Memory Diagnostic&quot; in the start menu) or use a more comprehensive tool like MemTest86 to rule out RAM issues. Let it run for multiple passes to ensure thorough testing.</span>
<a id=__codelineno-16-99 name=__codelineno-16-99 href=#__codelineno-16-99></a>
<a id=__codelineno-16-100 name=__codelineno-16-100 href=#__codelineno-16-100></a><span class=go>4. **Disk Integrity Check**:</span>
<a id=__codelineno-16-101 name=__codelineno-16-101 href=#__codelineno-16-101></a><span class=go>   - Run “chkdsk /f /r” in the Command Prompt (as Administrator) to check for and repair any disk errors. Note that this might require a restart.</span>
<a id=__codelineno-16-102 name=__codelineno-16-102 href=#__codelineno-16-102></a>
<a id=__codelineno-16-103 name=__codelineno-16-103 href=#__codelineno-16-103></a><span class=go>5. **Check for Malware or Corrupted System Files**:</span>
<a id=__codelineno-16-104 name=__codelineno-16-104 href=#__codelineno-16-104></a><span class=go>   - Run a full system scan using your antivirus software or use Windows Defender. Also, run “sfc /scannow” from an elevated Command Prompt to check for and repair corrupted system files.</span>
<a id=__codelineno-16-105 name=__codelineno-16-105 href=#__codelineno-16-105></a>
<a id=__codelineno-16-106 name=__codelineno-16-106 href=#__codelineno-16-106></a><span class=go>6. **Power and Sleep Settings**:</span>
<a id=__codelineno-16-107 name=__codelineno-16-107 href=#__codelineno-16-107></a><span class=go>   - Check the power settings (Control Panel &gt; Power Options) to ensure there are no custom settings that might be causing the laptop to shut down. Sometimes a faulty power plan can lead to unexpected behavior.</span>
<a id=__codelineno-16-108 name=__codelineno-16-108 href=#__codelineno-16-108></a>
<a id=__codelineno-16-109 name=__codelineno-16-109 href=#__codelineno-16-109></a><span class=go>7. **Physical Hardware Checks**:</span>
<a id=__codelineno-16-110 name=__codelineno-16-110 href=#__codelineno-16-110></a><span class=go>   - If you feel comfortable, open the laptop (if it&#39;s user-serviceable) to check for any loose connections, particularly around the power supply, motherboard, and battery. Check for any signs of damage or burnt components.</span>
<a id=__codelineno-16-111 name=__codelineno-16-111 href=#__codelineno-16-111></a>
<a id=__codelineno-16-112 name=__codelineno-16-112 href=#__codelineno-16-112></a><span class=go>8. **BIOS Settings**:</span>
<a id=__codelineno-16-113 name=__codelineno-16-113 href=#__codelineno-16-113></a><span class=go>   - Sometimes, certain settings in the BIOS related to power management can cause instability. Resetting the BIOS to default settings or updating to the latest version can sometimes help.</span>
<a id=__codelineno-16-114 name=__codelineno-16-114 href=#__codelineno-16-114></a>
<a id=__codelineno-16-115 name=__codelineno-16-115 href=#__codelineno-16-115></a><span class=go>If, after these advanced diagnostics, the issue persists, we may need to explore more severe hardware issues, such as problems with the motherboard or a failing power supply. If you’re comfortable with hardware repairs, consider the possibility of testing with known good components if available. Otherwise, professional service might be necessary. Let me know how it goes, and we can take further steps based on your findings.</span>
<a id=__codelineno-16-116 name=__codelineno-16-116 href=#__codelineno-16-116></a>
<a id=__codelineno-16-117 name=__codelineno-16-117 href=#__codelineno-16-117></a><span class=go>--------------------------------------------------------------------------------</span>
<a id=__codelineno-16-118 name=__codelineno-16-118 href=#__codelineno-16-118></a>
<a id=__codelineno-16-119 name=__codelineno-16-119 href=#__codelineno-16-119></a><span class=go>Next speaker: user</span>
<a id=__codelineno-16-120 name=__codelineno-16-120 href=#__codelineno-16-120></a>
<a id=__codelineno-16-121 name=__codelineno-16-121 href=#__codelineno-16-121></a><span class=go>Replying as user. Provide feedback to chat_manager. Press enter to skip and use auto-reply, or type &#39;exit&#39; to end the conversation: exit</span>
<a id=__codelineno-16-122 name=__codelineno-16-122 href=#__codelineno-16-122></a>
<a id=__codelineno-16-123 name=__codelineno-16-123 href=#__codelineno-16-123></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; TERMINATING RUN (e1d28d36-15f8-4e17-b021-c324cf82062a): User requested to end the conversation</span>
<a id=__codelineno-16-124 name=__codelineno-16-124 href=#__codelineno-16-124></a>
<a id=__codelineno-16-125 name=__codelineno-16-125 href=#__codelineno-16-125></a><span class=go>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; TERMINATING RUN (e9063a2a-4c36-443e-b938-02eee57e09f9): No reply generated</span>
</code></pre></div> <h2 id=next-steps-putting-everything-together-with-patterns>Next Steps: Putting Everything Together with Patterns<a class=headerlink href=#next-steps-putting-everything-together-with-patterns title="Permanent link">#</a></h2> <p>You've already seen <code>AutoPattern</code> in action in this example, where it allows the system to dynamically select agents based on conversation context. In the next section, you'll explore the full range of orchestration patterns available in AG2. In the upcoming "Patterns" section, you'll discover:</p> <ul> <li>How different pattern types (DefaultPattern, RoundRobinPattern, RandomPattern, etc.) offer alternative approaches to agent selection and conversation flow</li> <li>When to choose each pattern type based on your specific use case requirements</li> <li>How to customize patterns with additional configuration options</li> <li>Advanced techniques for combining patterns with handoffs, context variables, and tools</li> </ul> <p>The patterns section completes your understanding of AG2's orchestration capabilities, showing how these powerful components work together to create intelligent, responsive multi-agent systems for complex real-world tasks.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2025-07-06T15:13:42+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-07-06</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../context-variables/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Context Variables"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Context Variables </div> </div> </a> <a href=../patterns/ class="md-footer__link md-footer__link--next" aria-label="Next: Orchestration Patterns"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Orchestration Patterns </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy; 2025 <a href=https://ag2.ai/ target=_blank rel=noopener>ag2</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/pAbnFJrkgZ target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg> </a> <a href=https://github.com/ag2ai/ag2 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> <a href=https://x.com/ag2oss target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg> </a> <a href=https://www.youtube.com/@ag2ai target=_blank rel=noopener title=www.youtube.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg> </a> <a href=https://www.linkedin.com/company/ag2ai target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.tracking", "navigation.prune", "navigation.top", "navigation.footer", "content.tabs.link", "content.code.copy", "content.code.annotate", "content.action.edit"], "search": "../../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../../../../../../js/timeago.min.js></script> <script src=../../../../../../js/timeago_mkdocs_material.js></script> <script src=../../../../../../javascripts/extra.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>